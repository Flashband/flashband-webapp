[4mRunning "mochacov:cov" (mochacov) task[24m
<!DOCTYPE html><html><head><title>Coverage</title><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style></head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/controllers/AuthenticateController.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/controllers/</span><span class="basename">AuthenticateController.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/controllers/FlashbandController.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/controllers/</span><span class="basename">FlashbandController.js</span></a></li><li><span class="cov high">94</span><a href="#/home/luiz/Projects/flashband/api/api/controllers/FrontdoorController.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/controllers/</span><span class="basename">FrontdoorController.js</span></a></li><li><span class="cov low">38</span><a href="#/home/luiz/Projects/flashband/api/api/controllers/ShowgoerController.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/controllers/</span><span class="basename">ShowgoerController.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/hooks/seeds.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/hooks/</span><span class="basename">seeds.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/models/Entrance.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/models/</span><span class="basename">Entrance.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/models/Flashband.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/models/</span><span class="basename">Flashband.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/models/FlashbandBatch.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/models/</span><span class="basename">FlashbandBatch.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/models/Showgoer.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/models/</span><span class="basename">Showgoer.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/models/Token.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/models/</span><span class="basename">Token.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/models/User.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/models/</span><span class="basename">User.js</span></a></li><li><span class="cov high">90</span><a href="#/home/luiz/Projects/flashband/api/api/policies/authenticated.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/policies/</span><span class="basename">authenticated.js</span></a></li><li><span class="cov high">95</span><a href="#/home/luiz/Projects/flashband/api/api/services/AuthenticateService.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/services/</span><span class="basename">AuthenticateService.js</span></a></li><li><span class="cov high">97</span><a href="#/home/luiz/Projects/flashband/api/api/services/FlashbandBatchImporter.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/services/</span><span class="basename">FlashbandBatchImporter.js</span></a></li><li><span class="cov high">88</span><a href="#/home/luiz/Projects/flashband/api/api/services/FlashbandService.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/services/</span><span class="basename">FlashbandService.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/api/services/FrontdoorService.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/services/</span><span class="basename">FrontdoorService.js</span></a></li><li><span class="cov high">93</span><a href="#/home/luiz/Projects/flashband/api/api/services/ShowgoerService.js"><span class="dirname">/home/luiz/Projects/flashband/api/api/services/</span><span class="basename">ShowgoerService.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/blueprints.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">blueprints.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/bootstrap.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">bootstrap.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/connections.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">connections.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/cors.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">cors.js</span></a></li><li><span class="cov terrible">0</span><a href="#/home/luiz/Projects/flashband/api/config/csrf.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">csrf.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/env/development.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/env/</span><span class="basename">development.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/globals.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">globals.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/http.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">http.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/i18n.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">i18n.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/log.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">log.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/models.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">models.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/policies.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">policies.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/routes.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">routes.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/session.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">session.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/sockets.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">sockets.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/config/views.js"><span class="dirname">/home/luiz/Projects/flashband/api/config/</span><span class="basename">views.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/bootstrap.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/</span><span class="basename">bootstrap.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/DatabaseHelper.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">DatabaseHelper.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/FlashbandBatchHelper.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">FlashbandBatchHelper.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/FlashbandHelper.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">FlashbandHelper.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/FrontdoorHelper.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">FrontdoorHelper.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/ShowgoerHelper.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">ShowgoerHelper.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/StringReadableStream.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">StringReadableStream.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/helpers/UserHelper.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/helpers/</span><span class="basename">UserHelper.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/integration/controllers/AuthenticateController.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/integration/controllers/</span><span class="basename">AuthenticateController.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/integration/controllers/FlashbandController.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/integration/controllers/</span><span class="basename">FlashbandController.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/integration/controllers/FrontdoorController.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/integration/controllers/</span><span class="basename">FrontdoorController.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/integration/controllers/ShowgoerController.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/integration/controllers/</span><span class="basename">ShowgoerController.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/integration/shared-specs.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/integration/</span><span class="basename">shared-specs.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/models/Flashband.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/models/</span><span class="basename">Flashband.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/flashband/associate.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/flashband/</span><span class="basename">associate.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/flashband/blocked.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/flashband/</span><span class="basename">blocked.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/flashband/enable.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/flashband/</span><span class="basename">enable.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/flashband/exists.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/flashband/</span><span class="basename">exists.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/flashband/importer.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/flashband/</span><span class="basename">importer.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/check.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/</span><span class="basename">check.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/enter.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/</span><span class="basename">enter.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/leave.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/</span><span class="basename">leave.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/register.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/</span><span class="basename">register.test.js</span></a></li><li><span class="cov high">100</span><a href="#/home/luiz/Projects/flashband/api/test/unit/services/showgoer/create.test.js"><span class="dirname">/home/luiz/Projects/flashband/api/test/unit/services/showgoer/</span><span class="basename">create.test.js</span></a></li><a id="logo" href="http://visionmedia.github.io/mocha/">m</a></div><div id="stats" class="high"><div class="percentage">97%</div><div class="sloc">935</div><div class="hits">912</div><div class="misses">23</div></div><div id="files"><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/controllers/AuthenticateController.js">/home/luiz/Projects/flashband/api/api/controllers/AuthenticateController.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">7</div><div class="hits">7</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  login: function(req, res) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">2</td><td class="source">    var email = req.param('email');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">2</td><td class="source">    var password = req.param('password');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">2</td><td class="source">    AuthenticateService.webLogin(email, password).then(res.accepted, res.unauthorized);</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  authenticate: function(req, res) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">2</td><td class="source">    var password = req.param('password');</td></tr><tr class="hit"><td class="line">13</td><td class="hits">2</td><td class="source">    AuthenticateService.mobileLogin(password).then(res.accepted, res.unauthorized);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/controllers/FlashbandController.js">/home/luiz/Projects/flashband/api/api/controllers/FlashbandController.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">16</div><div class="hits">16</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var fs = require('fs');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  block: function(req, res) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">3</td><td class="source">    FlashbandService.block(req.param('tag')).then(function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">      res.ok({ message: 'Flashband blocked.' });</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    }).fail(function(err) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">2</td><td class="source">      res.forbidden(err.message);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  enable: function(req, res) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">4</td><td class="source">    req.file('flashbands').upload(function (err, files) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">4</td><td class="source">      if (err) { return res.serverError(err); }</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">4</td><td class="source">      var file = files[0];</td></tr><tr class="hit"><td class="line">19</td><td class="hits">4</td><td class="source">      var csvFile = fs.createReadStream(file.fd);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">4</td><td class="source">      FlashbandBatchImporter.parse(csvFile).then(function(flashbands) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">3</td><td class="source">        FlashbandService.enable(flashbands, req.body.name, fs.readFileSync(file.fd)).then(function(flashbandBatch) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">3</td><td class="source">          res.created({flashbandsEnabled: flashbandBatch.flashbands.length, message: 'Flashbands enabled successfully.' });</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">        }).fail(res.badRequest);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">      }).fail(res.badRequest);</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  summary: function(req, res) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">    Flashband.count({imported: true}).exec(function(err, count) {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">      if (err) { return res.serverError(err); }</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">      res.ok({total: count});</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/controllers/FrontdoorController.js">/home/luiz/Projects/flashband/api/api/controllers/FrontdoorController.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">19</div><div class="hits">18</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var getFlashbandTag = function(req) {</td></tr><tr class="hit"><td class="line">4</td><td class="hits">18</td><td class="source">  return req.param('tag');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var inputSuccessful  = {door: 'in',  message: 'Input successful.'};</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var outputSuccessful = {door: 'out', message: 'Output successful.'};</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  enter: function(req, res) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">4</td><td class="source">    FrontdoorService.registerEnter(getFlashbandTag(req)).then(function() {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">      res.created(inputSuccessful);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">    }).fail(function(ranson) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">3</td><td class="source">      res.forbidden(ranson.message);</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  leave: function(req, res) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">4</td><td class="source">    FrontdoorService.registerLeave(getFlashbandTag(req)).then(function() {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">      res.created(outputSuccessful);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    }).fail(function(ranson) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">3</td><td class="source">      res.forbidden(ranson.message);</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  cross: function(req, res) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">10</td><td class="source">    var tag = getFlashbandTag(req);</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">10</td><td class="source">    FrontdoorService.checkRegistered(tag).then(function (inside) {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">10</td><td class="source">      FrontdoorService[inside ? 'registerLeave' : 'registerEnter'](tag).then(function () {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">11</td><td class="source">        if (inside) { return res.created(outputSuccessful); }</td></tr><tr class="hit"><td class="line">33</td><td class="hits">5</td><td class="source">        res.created(inputSuccessful);</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">      }).fail(function(ranson) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">2</td><td class="source">        res.forbidden(ranson.message);</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    }).fail(function(ranson) {</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">      res.forbidden(ranson.message);</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/controllers/ShowgoerController.js">/home/luiz/Projects/flashband/api/api/controllers/ShowgoerController.js</h2><div id="stats" class="low"><div class="percentage">38%</div><div class="sloc">18</div><div class="hits">7</div><div class="misses">11</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  find: function (req, res) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">2</td><td class="source">    ShowgoerService.search(req.query).then(res.ok, function(ranson) {</td></tr><tr class="miss"><td class="line">6</td><td class="hits">0</td><td class="source">      res.badRequest(ranson.message);</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  create: function create (req, res) {</td></tr><tr class="miss"><td class="line">11</td><td class="hits">0</td><td class="source">    var showgoerParams = req.body;</td></tr><tr class="miss"><td class="line">12</td><td class="hits">0</td><td class="source">    ShowgoerService.create(showgoerParams).then(res.created, function(ranson) {</td></tr><tr class="miss"><td class="line">13</td><td class="hits">0</td><td class="source">      res.badRequest(ranson.message);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  summary: function(req, res) {</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">    ShowgoerService.summary().then(res.ok, function(ranson) {</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">      res.badRequest(ranson.message);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  search: function(req, res) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">3</td><td class="source">    var args;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">3</td><td class="source">    if (req.query.s) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">3</td><td class="source">      args = {</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">        or: [{ name: { 'contains': req.query.s }},</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">             { docNumber: { 'contains': req.query.s }}]</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">3</td><td class="source">    ShowgoerService.search(args).then(res.ok, function(ranson) {</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">      res.badRequest(ranson.message);</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  associate: function(req, res) {</td></tr><tr class="miss"><td class="line">39</td><td class="hits">0</td><td class="source">    var showGoerId = req.param('showgoerId');</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">    var flashBandTag = req.param('tag');</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">    ShowgoerService.associate(showGoerId, flashBandTag).then(res.ok, function(ranson) {</td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">      res.badRequest(ranson.message);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/hooks/seeds.js">/home/luiz/Projects/flashband/api/api/hooks/seeds.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">12</div><div class="hits">12</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var glob  = require('glob'),</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    path  = require('path'),</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">    async = require('async');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function seedsHook(sails) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">  return {</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    initialize: function (callback) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">      sails.after('hook:orm:loaded', function () {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">        // Find all seed files by environment.</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">        glob('seeds/' + sails.config.environment + '/**/*.json',  function (err, files) {</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">          /**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">           * Populate the model with a given seed.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">           */</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">          function populate(seed, next) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">3</td><td class="source">            var attributes = Object.keys(seed.data[0] || {});</td></tr><tr class="hit"><td class="line">20</td><td class="hits">3</td><td class="source">            global[seed.model].findOrCreateEach(attributes, seed.data, next);</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">          // Extract seeds data.</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">          var seeding = files.map(function (filePath) {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">3</td><td class="source">            return {</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">              model: path.basename(filePath, '.json'),</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">              data: require('../../' + filePath)</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">            };</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">          async.eachSeries(seeding, populate, callback);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/models/Entrance.js">/home/luiz/Projects/flashband/api/api/models/Entrance.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoCreatedAt: true,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  attributes: {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    tag: { type: 'string' },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    leave: { type: 'datetime' }</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/models/Flashband.js">/home/luiz/Projects/flashband/api/api/models/Flashband.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">3</div><div class="hits">3</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoCreatedAt: true,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  attributes: {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    tag: {</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">      type: 'string',</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">      unique: true</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    imported: {</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">      type: 'boolean',</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">      defaultsTo: true</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    showgoer: {</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">      type: 'string'</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    serial: { type: 'string', columnName: 'srl' },</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    blockedAt: { type: 'datetime', columnName: 'blkd_at' },</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    blocked: function() {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">37</td><td class="source">      return Boolean(this.blockedAt);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/models/FlashbandBatch.js">/home/luiz/Projects/flashband/api/api/models/FlashbandBatch.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">3</div><div class="hits">3</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoCreatedAt: true,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  attributes: {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    name: { type: 'string' },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    file: { type: 'string' },</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    flashbands: { collection: 'Flashband', dominant: true },</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    inactivate: function() {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">2</td><td class="source">      this.active = false;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/models/Showgoer.js">/home/luiz/Projects/flashband/api/api/models/Showgoer.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoCreatedAt: true,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  attributes: {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    name: { type: 'string' },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    docType: { type: 'string' },</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    docNumber: { type: 'string' }</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/models/Token.js">/home/luiz/Projects/flashband/api/api/models/Token.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoCreatedAt: true,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  attributes: {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    user: { model:'user' },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    token: { type: 'string' }</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/models/User.js">/home/luiz/Projects/flashband/api/api/models/User.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoCreatedAt: true,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  attributes: {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">    email: { type: 'string' },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">    tokens: { collection: 'token', via: 'user' },</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    mobpassword: { type: 'string' },</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    webpassword: { type: 'string' }</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/policies/authenticated.js">/home/luiz/Projects/flashband/api/api/policies/authenticated.js</h2><div id="stats" class="high"><div class="percentage">90%</div><div class="sloc">11</div><div class="hits">10</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = function (req, res, next) {</td></tr><tr class="hit"><td class="line">4</td><td class="hits">31</td><td class="source">  var spliter = req.headers.authorization.split('Token token=');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">31</td><td class="source">  if (!req.headers.authorization) { return res.unauthorized(); }</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">31</td><td class="source">  var token = false;</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">62</td><td class="source">  if (spliter.length === 2) { token = spliter[1]; }</td></tr><tr class="hit"><td class="line">10</td><td class="hits">31</td><td class="source">  if (!token) { return res.unauthorized(); }</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">31</td><td class="source">  AuthenticateService.checkTokenValid(token).then(function(allowed) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">31</td><td class="source">    if (!allowed) { return res.unauthorized(); }</td></tr><tr class="hit"><td class="line">14</td><td class="hits">31</td><td class="source">    next();</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  }).fail(function(err) {</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">    res.serverError(err);</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/services/AuthenticateService.js">/home/luiz/Projects/flashband/api/api/services/AuthenticateService.js</h2><div id="stats" class="high"><div class="percentage">95%</div><div class="sloc">24</div><div class="hits">23</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var Q = require('q');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var tokenHasher = require('password-hash');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var auth = function(argsFind) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">4</td><td class="source">  var generateToken = function(user) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">6</td><td class="source">    if (!user) { throw new Error('user not found'); }</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">2</td><td class="source">    var args = {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">      token: tokenHasher.generate(user.id)</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">2</td><td class="source">    user.tokens.add(args);</td></tr><tr class="hit"><td class="line">15</td><td class="hits">2</td><td class="source">    return user.save().then(function() {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">2</td><td class="source">      args.user = user;</td></tr><tr class="hit"><td class="line">17</td><td class="hits">2</td><td class="source">      return args;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">4</td><td class="source">  return User.findOne(argsFind).then(generateToken);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  webLogin: function(email, password) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">2</td><td class="source">    return auth({email: email, webpassword: password});</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  mobileLogin: function(password) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">2</td><td class="source">    return auth({mobpassword: password});</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  checkTokenValid: function(accessToken) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">31</td><td class="source">    var deferred = Q.defer();</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">31</td><td class="source">    if (accessToken &amp;&amp; tokenHasher.isHashed(accessToken)) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">31</td><td class="source">      var resolve = function(err, theToken) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">31</td><td class="source">        if (err) { return deferred.resolve(false); }</td></tr><tr class="hit"><td class="line">39</td><td class="hits">31</td><td class="source">        if (!theToken) { return deferred.resolve(false); }</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">31</td><td class="source">        deferred.resolve(theToken.token === accessToken);</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">31</td><td class="source">      Token.findOne({token: accessToken}).exec(resolve);</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">      deferred.resolve(false);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">31</td><td class="source">    return deferred.promise;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/services/FlashbandBatchImporter.js">/home/luiz/Projects/flashband/api/api/services/FlashbandBatchImporter.js</h2><div id="stats" class="high"><div class="percentage">97%</div><div class="sloc">49</div><div class="hits">48</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var csv = require('csv');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var q = require('q');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var validate = function(flashbands) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">14</td><td class="source">  var result = {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    ok: true,</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    error: false</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  };</td></tr><tr class="hit"><td class="line">11</td><td class="hits">14</td><td class="source">  if (flashbands.length === 0) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">4</td><td class="source">    result.ok = false;</td></tr><tr class="hit"><td class="line">13</td><td class="hits">4</td><td class="source">    result.error = 'No flashbands found.';</td></tr><tr class="hit"><td class="line">14</td><td class="hits">4</td><td class="source">    return result;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">10</td><td class="source">  var tags = [];</td></tr><tr class="hit"><td class="line">18</td><td class="hits">10</td><td class="source">  var serials = [];</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">10</td><td class="source">  for (var i = 0; i &lt; flashbands.length; i++) {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">16</td><td class="source">    var flashband = flashbands[i];</td></tr><tr class="hit"><td class="line">22</td><td class="hits">16</td><td class="source">    if (!flashband.tag) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">      result.ok = false;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">      result.error = 'Missing UID.';</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">      return result;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">27</td><td class="hits">15</td><td class="source">    if (!flashband.serial) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">2</td><td class="source">      result.ok = false;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">2</td><td class="source">      result.error = 'Missing Qrcode.';</td></tr><tr class="hit"><td class="line">30</td><td class="hits">2</td><td class="source">      return result;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">32</td><td class="hits">13</td><td class="source">    if (tags.indexOf(flashband.tag) &gt; -1) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">      result.ok = false;</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">      result.error = 'Duplicated UID.';</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">      return result;</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">37</td><td class="hits">12</td><td class="source">    tags.push(flashband.tag);</td></tr><tr class="hit"><td class="line">38</td><td class="hits">12</td><td class="source">    if (serials.indexOf(flashband.serial) &gt; -1) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">      result.ok = false;</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">      result.error = 'Duplicated Qrcode.';</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">      return result;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">43</td><td class="hits">11</td><td class="source">    serials.push(flashband.serial);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">45</td><td class="hits">5</td><td class="source">  return result;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  parse: function(input) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">14</td><td class="source">    var defer = q.defer();</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">14</td><td class="source">    var parser = csv.parse({columns: true, trim: true, delimiter: ';'});</td></tr><tr class="hit"><td class="line">53</td><td class="hits">14</td><td class="source">    var flashbands = [];</td></tr><tr class="hit"><td class="line">54</td><td class="hits">14</td><td class="source">    var transformer = csv.transform(function(record) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">26</td><td class="source">      if (!(record.UID || record.Qrcode)) { return; }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">16</td><td class="source">      var tag = record.UID.replace(/\s/g, '').toUpperCase();</td></tr><tr class="hit"><td class="line">58</td><td class="hits">16</td><td class="source">      var serial = record.Qrcode;</td></tr><tr class="hit"><td class="line">59</td><td class="hits">16</td><td class="source">      flashbands.push({tag: tag, serial: serial});</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">14</td><td class="source">    transformer.on('finish', function() {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">14</td><td class="source">      var validation = validate(flashbands);</td></tr><tr class="hit"><td class="line">64</td><td class="hits">19</td><td class="source">      if (validation.ok) { return defer.resolve(flashbands); }</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">9</td><td class="source">      defer.reject(new Error(validation.error));</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">14</td><td class="source">    transformer.on('error', function(err) {</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">      defer.reject(err);</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">14</td><td class="source">    input.pipe(parser).pipe(transformer);</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">14</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/services/FlashbandService.js">/home/luiz/Projects/flashband/api/api/services/FlashbandService.js</h2><div id="stats" class="high"><div class="percentage">88%</div><div class="sloc">54</div><div class="hits">48</div><div class="misses">6</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var q = require('q');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var inactivate = function(flashbandBatches) {</td></tr><tr class="hit"><td class="line">6</td><td class="hits">9</td><td class="source">  flashbandBatches.forEach(function(flashbandBatch) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">2</td><td class="source">    flashbandBatch.inactivate();</td></tr><tr class="hit"><td class="line">8</td><td class="hits">2</td><td class="source">    flashbandBatch.save();</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  findOne: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">47</td><td class="source">    return Flashband.findOne({ tag: flashbandUid.replace(/\s/g, '').toUpperCase(), imported: true });</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  findByShowgoer: function(showgoerId) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">10</td><td class="source">    return Flashband.findOne({ showgoer: showgoerId, blockedAt: null, imported: true  });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  exists: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">47</td><td class="source">    return this.findOne(flashbandUid).then(function(flashband) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">57</td><td class="source">      if (!flashband) { throw new Error('Flashband not found.'); }</td></tr><tr class="hit"><td class="line">24</td><td class="hits">37</td><td class="source">      return flashband;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  block: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">7</td><td class="source">    return this.exists(flashbandUid).then(function(flashband) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">7</td><td class="source">      if (flashband.blocked()) { throw new Error('Flashband already blocked.'); }</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">3</td><td class="source">      flashband.blockedAt = new Date();</td></tr><tr class="hit"><td class="line">33</td><td class="hits">3</td><td class="source">      return flashband.save();</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  findAssociations: function(listShowGoers) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">5</td><td class="source">    var defer = q.defer();</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">5</td><td class="source">    var findAssociation = function(showGoer, next) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">4</td><td class="source">      FlashbandService.findByShowgoer(showGoer.id).exec(function(err, flashband) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">4</td><td class="source">        showGoer.flashband = '';</td></tr><tr class="hit"><td class="line">43</td><td class="hits">4</td><td class="source">        if (flashband) { showGoer.flashband = flashband.tag; }</td></tr><tr class="hit"><td class="line">44</td><td class="hits">4</td><td class="source">        next();</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">5</td><td class="source">    async.each(listShowGoers, findAssociation, function(err) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">5</td><td class="source">      if (err) { return defer.reject(err); }</td></tr><tr class="hit"><td class="line">50</td><td class="hits">5</td><td class="source">      defer.resolve(listShowGoers);</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">5</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  deleteAllFlashbands: function() {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">10</td><td class="source">    return Flashband.update({imported: true}, {imported: false}).then(function(updateds) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">10</td><td class="source">      return updateds;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  enable: function(flashbands, name, file) {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">10</td><td class="source">    var defer = q.defer();</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">10</td><td class="source">    this.deleteAllFlashbands().then(function afterLogicallyDeleteRecords() {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">10</td><td class="source">      var newFlashbands = [];</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">68</td><td class="hits">10</td><td class="source">      var createFlashband = function(arg, next) {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">12</td><td class="source">        var create = {</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">          tag: arg.tag,</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">          imported: true,</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">          blockedAt: null,</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">          showgoer: null</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">        };</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">76</td><td class="hits">12</td><td class="source">        Flashband.findOrCreate(arg, create, function(err, flashband) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">13</td><td class="source">          if (err) { return defer.reject(err); }</td></tr><tr class="hit"><td class="line">78</td><td class="hits">11</td><td class="source">          newFlashbands.push(flashband);</td></tr><tr class="hit"><td class="line">79</td><td class="hits">11</td><td class="source">          next();</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">10</td><td class="source">      async.each(flashbands, createFlashband, function(err) {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">9</td><td class="source">        if (err) {</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">          defer.reject(err instanceof Error ? err : new Error(err));</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">          return;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">9</td><td class="source">        FlashbandBatch.find({active: true}).exec(function(err, flashbandBatches) {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">9</td><td class="source">          if (err) {</td></tr><tr class="miss"><td class="line">91</td><td class="hits">0</td><td class="source">            defer.reject(err);</td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">            return;</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">9</td><td class="source">          inactivate(flashbandBatches);</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">9</td><td class="source">          FlashbandBatch.create({name: name, file: file, active: true}).exec(function(err, flashbandBatch) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">9</td><td class="source">            if (err) {</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">              defer.reject(err);</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">              return;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">103</td><td class="hits">9</td><td class="source">            newFlashbands.forEach(function(flashband) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">10</td><td class="source">              flashbandBatch.flashbands.add(flashband.id);</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">107</td><td class="hits">9</td><td class="source">            flashbandBatch.save().then(defer.resolve, defer.reject);</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">    }, defer.reject);</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">113</td><td class="hits">10</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/services/FrontdoorService.js">/home/luiz/Projects/flashband/api/api/services/FrontdoorService.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">22</div><div class="hits">22</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var validate = function(flashbandUid) {</td></tr><tr class="hit"><td class="line">4</td><td class="hits">28</td><td class="source">  return FlashbandService.exists(flashbandUid).then(function(flashband) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">27</td><td class="source">    if (flashband.blocked()) { throw new Error('Blocked flashband.'); }</td></tr><tr class="hit"><td class="line">6</td><td class="hits">17</td><td class="source">    return flashband;</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  registerEnter: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">16</td><td class="source">    return validate(flashbandUid).then(function(flashband) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">10</td><td class="source">      return FrontdoorService.checkRegistered(flashband.tag).then(function(registered) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">12</td><td class="source">        if (registered) { throw new Error('Duplicated entrance.'); }</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">8</td><td class="source">        return Entrance.create({ tag: flashbandUid }).then(function(entranceModel) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">8</td><td class="source">          return entranceModel;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  registerLeave: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">12</td><td class="source">    return validate(flashbandUid).then(function(flashband) {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">7</td><td class="source">      return FrontdoorService.checkAlreadyOut(flashband.tag).then(function(alreadyOut) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">9</td><td class="source">        if (alreadyOut) { throw new Error('Duplicated exit.'); }</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">5</td><td class="source">        return Entrance.findOne({ tag: flashbandUid, leave: null }).then(function(entranceModel) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">5</td><td class="source">          entranceModel.leave = new Date();</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">5</td><td class="source">          return entranceModel.save().then(function(mdl) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">5</td><td class="source">            return mdl;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  checkRegistered: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">22</td><td class="source">    return Entrance.findOne({ tag: flashbandUid, leave: null }).then(function(found) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">22</td><td class="source">      return Boolean(found);</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  checkAlreadyOut: function(flashbandUid) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">7</td><td class="source">    return Entrance.findOne({ tag: flashbandUid, leave: null }).then(function(found) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">7</td><td class="source">      return !Boolean(found);</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/api/services/ShowgoerService.js">/home/luiz/Projects/flashband/api/api/services/ShowgoerService.js</h2><div id="stats" class="high"><div class="percentage">93%</div><div class="sloc">32</div><div class="hits">30</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var q = require('q');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  create: function(showGoerParams) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">11</td><td class="source">    var saveShowGoer = function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">6</td><td class="source">      var showgoer = {</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">        name: showGoerParams.name,</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">        docType: showGoerParams.docType,</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">        docNumber: showGoerParams.docNumber</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">6</td><td class="source">      return Showgoer.create(showgoer).then(function(model) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">6</td><td class="source">        return model;</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">11</td><td class="source">    return this.isValidForSave(showGoerParams).then(saveShowGoer);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  summary: function() {</td></tr><tr class="miss"><td class="line">23</td><td class="hits">0</td><td class="source">    return Showgoer.count().then(function(count) {</td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="source">      return {total: count};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  isValidForSave: function(showGoerParams) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">11</td><td class="source">    var defer = q.defer();</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">11</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">12</td><td class="source">      if (!showGoerParams.name)      { throw new Error('Name is required.');            }</td></tr><tr class="hit"><td class="line">33</td><td class="hits">11</td><td class="source">      if (!showGoerParams.docType)   { throw new Error('Document type is required.');   }</td></tr><tr class="hit"><td class="line">34</td><td class="hits">10</td><td class="source">      if (!showGoerParams.docNumber) { throw new Error('Document number is required.'); }</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">8</td><td class="source">      var validTypes = ['cpf', 'rg', 'cnh', 'passport'];</td></tr><tr class="hit"><td class="line">37</td><td class="hits">8</td><td class="source">      var typeIsInvalid = validTypes.indexOf(showGoerParams.docType) &lt; 0;</td></tr><tr class="hit"><td class="line">38</td><td class="hits">9</td><td class="source">      if (typeIsInvalid) { throw new Error('Invalid document type.'); }</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">7</td><td class="source">      Showgoer.findOne({docType: showGoerParams.docType, docNumber: showGoerParams.docNumber}).exec(function (err, saved) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">8</td><td class="source">        if (saved) { return defer.reject(new Error('Duplicated document.')); }</td></tr><tr class="hit"><td class="line">42</td><td class="hits">6</td><td class="source">        defer.resolve(true);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    } catch (err) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">4</td><td class="source">      defer.reject(err);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">11</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  search: function(args) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">5</td><td class="source">    return Showgoer.find(args).then(function(listShowGoers) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">5</td><td class="source">      return FlashbandService.findAssociations(listShowGoers);</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  associate: function(showGoerId, flashBandTag) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">8</td><td class="source">    return FlashbandService.exists(flashBandTag).then(function(flashband) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">9</td><td class="source">      if (flashband.blocked()) { throw new Error('Blocked Flashband'); }</td></tr><tr class="hit"><td class="line">61</td><td class="hits">8</td><td class="source">      if (flashband.showgoer) { throw new Error('Flashband ever associated'); }</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">6</td><td class="source">      return FlashbandService.findByShowgoer(showGoerId).then(function(flashbandAssocieted) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">7</td><td class="source">        if (flashbandAssocieted) { throw new Error('Showgoer ever associated'); }</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">5</td><td class="source">        flashband.showgoer = showGoerId;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">5</td><td class="source">        return flashband.save();</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/blueprints.js">/home/luiz/Projects/flashband/api/config/blueprints.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Blueprint API Configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.blueprints)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * These settings are for the global configuration of blueprint routes and</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * request options (which impact the behavior of blueprint actions).</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * You may also override any of these settings on a per-controller basis</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * by defining a '_config' key in your controller defintion, and assigning it</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * a configuration object with overrides for the settings in this file.</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * A lot of the configuration options below affect so-called &quot;CRUD methods&quot;,</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * or your controllers' `find`, `create`, `update`, and `destroy` actions.</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * It's important to realize that, even if you haven't defined these yourself, as long as</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * a model exists with the same name as the controller, Sails will respond with built-in CRUD</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * logic in the form of a JSON API, including support for sort, pagination, and filtering.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * For more information on the blueprint API, check out:</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/blueprint-api</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * For more information on the settings in this file, see:</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.blueprints.html</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">module.exports.blueprints = {</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  * Action routes speed up the backend development workflow by               *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  * eliminating the need to manually bind routes. When enabled, GET, POST,   *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  * PUT, and DELETE routes will be generated for every one of a controller's *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  * actions.                                                                 *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  * If an `index` action exists, additional naked routes will be created for *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  * it. Finally, all `actions` blueprints support an optional path           *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  * parameter, `id`, for convenience.                                        *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  * `actions` are enabled by default, and can be OK for production--         *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  * however, if you'd like to continue to use controller/action autorouting  *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  * in a production deployment, you must take great care not to              *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  * inadvertently expose unsafe/unintentional controller logic to GET        *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  * requests.                                                                *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  actions: false,</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  * RESTful routes (`sails.config.blueprints.rest`)                          *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  * REST blueprints are the automatically generated routes Sails uses to     *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  * expose a conventional REST API on top of a controller's `find`,          *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  * `create`, `update`, and `destroy` actions.                               *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  * For example, a BoatController with `rest` enabled generates the          *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  * following routes:                                                        *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  * :::::::::::::::::::::::::::::::::::::::::::::::::::::::                  *</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  *  GET /boat/:id? -&gt; BoatController.find                                   *</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  *  POST /boat -&gt; BoatController.create                                     *</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  *  PUT /boat/:id -&gt; BoatController.update                                  *</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  *  DELETE /boat/:id -&gt; BoatController.destroy                              *</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  * `rest` blueprint routes are enabled by default, and are suitable for use *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  * in a production scenario, as long you take standard security precautions *</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  * (combine w/ policies, etc.)                                              *</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  rest: false,</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  * Shortcut routes are simple helpers to provide access to a                *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  * controller's CRUD methods from your browser's URL bar. When enabled,     *</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  * GET, POST, PUT, and DELETE routes will be generated for the              *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  * controller's`find`, `create`, `update`, and `destroy` actions.           *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  * `shortcuts` are enabled by default, but should be disabled in            *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  * production.                                                              *</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  shortcuts: false,</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">  * An optional mount path for all blueprint routes on a controller,         *</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">  * including `rest`, `actions`, and `shortcuts`. This allows you to take    *</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  * advantage of blueprint routing, even if you need to namespace your API   *</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">  * methods.                                                                 *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  * (NOTE: This only applies to blueprint autoroutes, not manual routes from *</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  * `sails.config.routes`)                                                   *</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">  // prefix: '',</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  * Whether to pluralize controller names in blueprint routes.               *</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  * (NOTE: This only applies to blueprint autoroutes, not manual routes from *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">  * `sails.config.routes`)                                                   *</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  * For example, REST blueprints for `FooController` with `pluralize`        *</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  * enabled:                                                                 *</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">  * GET /foos/:id?                                                           *</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">  * POST /foos                                                               *</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">  * PUT /foos/:id?                                                           *</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">  * DELETE /foos/:id?                                                        *</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  // pluralize: false,</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  * Whether the blueprint controllers should populate model fetches with     *</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">  * data from other models which are linked by associations                  *</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">  * If you have a lot of data in one-to-many associations, leaving this on   *</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  * may result in very heavy api calls                                       *</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">  // populate: true,</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">  * Whether to run Model.watch() in the find and findOne blueprint actions.   *</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  * Can be overridden on a per-model basis.                                   *</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">  // autoWatch: true,</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">  * The default number of records to show in the response from a &quot;find&quot;       *</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">  * action. Doubles as the default size of populated arrays if populate is    *</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">  * true.                                                                     *</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">  // defaultLimit: 30</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/bootstrap.js">/home/luiz/Projects/flashband/api/config/bootstrap.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Bootstrap</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.bootstrap)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * An asynchronous bootstrap function that runs before your Sails app gets lifted.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * This gives you an opportunity to set up your data model, run jobs, or perform some special logic.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * For more information on bootstrapping your app, check out:</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.bootstrap.html</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">module.exports.bootstrap = function(cb) {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  // It's very important to trigger this callback method when you are finished</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  // with the bootstrap!  (otherwise your server will never lift, since it's waiting on the bootstrap)</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">  cb();</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/connections.js">/home/luiz/Projects/flashband/api/config/connections.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Connections</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.connections)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * `Connections` are like &quot;saved settings&quot; for your adapters.  What's the difference between</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * a connection and an adapter, you might ask?  An adapter (e.g. `sails-mysql`) is generic--</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * it needs some additional information to work (e.g. your database host, password, user, etc.)</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * A `connection` is that additional information.</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Each model must have a `connection` property (a string) which is references the name of one</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * of these connections.  If it doesn't, the default `connection` configured in `config/models.js`</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * will be applied.  Of course, a connection can (and usually is) shared by multiple models.</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * .</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * Note: If you're using version control, you should put your passwords/api keys</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * in `config/local.js`, environment variables, or use another strategy.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * (this is to prevent you inadvertently sensitive credentials up to your repository.)</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * For more information on configuration, check out:</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.connections.html</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">module.exports.connections = {</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  * Local disk storage for DEVELOPMENT ONLY                                  *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  * Installed by default.                                                    *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  localDiskDb: {</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    adapter: 'sails-disk'</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  * MySQL is the world's most popular relational database.                   *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  * http://en.wikipedia.org/wiki/MySQL                                       *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  * Run: npm install sails-mysql                                             *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  someMysqlServer: {</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    adapter: 'sails-mysql',</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    host: 'YOUR_MYSQL_SERVER_HOSTNAME_OR_IP_ADDRESS',</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    user: 'YOUR_MYSQL_USER',</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    password: 'YOUR_MYSQL_PASSWORD',</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    database: 'YOUR_MYSQL_DB'</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  * MongoDB is the leading NoSQL database.                                   *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  * http://en.wikipedia.org/wiki/MongoDB                                     *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  * Run: npm install sails-mongo                                             *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  mongodbServer: {</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    adapter: 'sails-mongo',</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    host: 'localhost',</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    port: 27017,</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">    // user: 'username',</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    // password: 'password',</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    database: 'flashband_dev'</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  cProd: {</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    adapter: 'sails-mongo',</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    host: 'localhost',</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    port: 27017,</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    database: 'fbProd'</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  * PostgreSQL is another officially supported relational database.          *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  * http://en.wikipedia.org/wiki/PostgreSQL                                  *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  * Run: npm install sails-postgresql                                        *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">  somePostgresqlServer: {</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">    adapter: 'sails-postgresql',</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    host: 'YOUR_POSTGRES_SERVER_HOSTNAME_OR_IP_ADDRESS',</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    user: 'YOUR_POSTGRES_USER',</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">    password: 'YOUR_POSTGRES_PASSWORD',</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    database: 'YOUR_POSTGRES_DB'</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  * More adapters: https://github.com/balderdashy/sails                      *</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/cors.js">/home/luiz/Projects/flashband/api/config/cors.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Cross-Origin Resource Sharing (CORS) Settings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.cors)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * CORS is like a more modern version of JSONP-- it allows your server/API</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * to successfully respond to requests from client-side JavaScript code</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * running on some other domain (e.g. google.com)</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * Unlike JSONP, it works with POST, PUT, and DELETE requests</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * For more information on CORS, check out:</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * http://en.wikipedia.org/wiki/Cross-origin_resource_sharing</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * Note that any of these settings (besides 'allRoutes') can be changed on a per-route basis</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * by adding a &quot;cors&quot; object to the route configuration:</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * '/get foo': {</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *   controller: 'foo',</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *   action: 'bar',</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *   cors: {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *     origin: 'http://foobar.com,https://owlhoot.com'</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *   }</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *  }</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *  For more information on this configuration file, see:</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> *  http://sailsjs.org/#/documentation/reference/sails.config/sails.config.cors.html</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">module.exports.cors = {</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  * Allow CORS on all routes by default? If not, you must enable CORS on a   *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  * per-route basis by either adding a &quot;cors&quot; configuration object to the    *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  * route config, or setting &quot;cors:true&quot; in the route config to use the      *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  * default settings below.                                                  *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  allRoutes: true,</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  * Which domains which are allowed CORS access? This can be a               *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  * comma-delimited list of hosts (beginning with http:// or https://) or    *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  * &quot;*&quot; to allow all domains CORS access.                                    *</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  // origin: '*',</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  * Allow cookies to be shared for CORS requests?                            *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  // credentials: true,</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  * Which methods should be allowed for CORS requests? This is only used in  *</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  * response to preflight requests (see article linked above for more info)  *</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  // methods: 'GET, POST, PUT, DELETE, OPTIONS, HEAD',</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  * Which headers should be allowed for CORS requests? This is only used in  *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  * response to preflight requests.                                          *</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  headers: ['content-type', 'authorization']</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/csrf.js">/home/luiz/Projects/flashband/api/config/csrf.js</h2><div id="stats" class="terrible"><div class="percentage">0%</div><div class="sloc">0</div><div class="hits">0</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Cross-Site Request Forgery Protection Settings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.csrf)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * CSRF tokens are like a tracking chip.  While a session tells the server that a user</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * &quot;is who they say they are&quot;, a csrf token tells the server &quot;you are where you say you are&quot;.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * When enabled, all non-GET requests to the Sails server must be accompanied by</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * a special token, identified as the '_csrf' parameter.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * This option protects your Sails app against cross-site request forgery (or CSRF) attacks.</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * A would-be attacker needs not only a user's session cookie, but also this timestamped,</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * secret CSRF token, which is refreshed/granted when the user visits a URL on your app's domain.</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * This allows us to have certainty that our users' requests haven't been hijacked,</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * and that the requests they're making are intentional and legitimate.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * This token has a short-lived expiration timeline, and must be acquired by either:</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * (a)		For traditional view-driven web apps:</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *			Fetching it from one of your views, where it may be accessed as</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *			a local variable, e.g.:</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *			&lt;form&gt;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *				&lt;input type=&quot;hidden&quot; name=&quot;_csrf&quot; value=&quot;&lt;%= _csrf %&gt;&quot; /&gt;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> *			&lt;/form&gt;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * or (b)	For AJAX/Socket-heavy and/or single-page apps:</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *			Sending a GET request to the `/csrfToken` route, where it will be returned</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *			as JSON, e.g.:</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *			{ _csrf: 'ajg4JD(JGdajhLJALHDa' }</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Enabling this option requires managing the token in your front-end app.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * For traditional web apps, it's as easy as passing the data from a view into a form action.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * In AJAX/Socket-heavy apps, just send a GET request to the /csrfToken route to get a valid token.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * For more information on CSRF, check out:</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * http://en.wikipedia.org/wiki/Cross-site_request_forgery</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * For more information on this configuration file, including info on CSRF + CORS, see:</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * http://beta.sailsjs.org/#/documentation/reference/sails.config/sails.config.csrf.html</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/****************************************************************************</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">*                                                                           *</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">* Enabled CSRF protection for your site?                                    *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">*                                                                           *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">****************************************************************************/</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">// module.exports.csrf = false;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/****************************************************************************</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">*                                                                           *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">* You may also specify more fine-grained settings for CSRF, including the   *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">* domains which are allowed to request the CSRF token via AJAX. These       *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">* settings override the general CORS settings in your config/cors.js file.  *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">*                                                                           *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">****************************************************************************/</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">// module.exports.csrf = {</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">//    grantTokenViaAjax: true,</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">//    origin: ''</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">// }</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/env/development.js">/home/luiz/Projects/flashband/api/config/env/development.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Development environment settings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * This file can include shared settings for a development team,</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * such as API keys or remote database passwords.  If you're using</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * a version control solution for your Sails app, this file will</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * be committed to your repository unless you add it to your .gitignore</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * file.  If your repository will be publicly viewable, don't add</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * any private information to this file!</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  models: {</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    connection: 'mongodbServer',</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    migrate: 'drop'</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/globals.js">/home/luiz/Projects/flashband/api/config/globals.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Global Variable Configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.globals)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Configure which global variables which will be exposed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * automatically by Sails.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * For more information on configuration, check out:</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.globals.html</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">module.exports.globals = {</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  * Expose the lodash installed in Sails core as a global variable. If this   *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  * is disabled, like any other node module you can always run npm install    *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  * lodash --save, then var _ = require('lodash') at the top of any file.     *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">	// _: true,</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  * Expose the async installed in Sails core as a global variable. If this is *</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  * disabled, like any other node module you can always run npm install async *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  * --save, then var async = require('async') at the top of any file.         *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">	// async: true,</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  * Expose the sails instance representing your app. If this is disabled, you *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  * can still get access via req._sails.                                      *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">	// sails: true,</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  * Expose each of your app's services as global variables (using their       *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  * &quot;globalId&quot;). E.g. a service defined in api/models/NaturalLanguage.js      *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  * would have a globalId of NaturalLanguage by default. If this is disabled, *</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  * you can still access your services via sails.services.*                   *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">	// services: true,</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  * Expose each of your app's models as global variables (using their         *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  * &quot;globalId&quot;). E.g. a model defined in api/models/User.js would have a      *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  * globalId of User by default. If this is disabled, you can still access    *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  * your models via sails.models.*.                                           *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">	// models: true</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/http.js">/home/luiz/Projects/flashband/api/config/http.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * HTTP Server Settings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.http)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Configuration for the underlying HTTP server in Sails.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * Only applies to HTTP requests (not WebSockets)</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * For more information on configuration, check out:</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.http.html</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">module.exports.http = {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  * Express middleware to use for every Sails request. To add custom          *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  * middleware to the mix, add a function to the middleware config object and *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  * add its key to the &quot;order&quot; array. The $custom key is reserved for         *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  * backwards-compatibility with Sails v0.9.x apps that use the               *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  * `customMiddleware` config option.                                         *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  // middleware: {</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  * The order in which middleware should be run for HTTP request. (the Sails *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  * router is invoked by the &quot;router&quot; middleware below.)                     *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    // order: [</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    //   'startRequestTimer',</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    //   'cookieParser',</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    //   'session',</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    //   'myRequestLogger',</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">    //   'bodyParser',</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    //   'handleBodyParserError',</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    //   'compress',</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    //   'methodOverride',</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    //   'poweredBy',</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    //   '$custom',</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    //   'router',</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    //   'www',</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    //   'favicon',</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    //   '404',</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    //   '500'</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    // ],</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  * Example custom middleware; logs each request to the console.              *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    // myRequestLogger: function (req, res, next) {</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    //     console.log(&quot;Requested :: &quot;, req.method, req.url);</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    //     return next();</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    // }</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  * The body parser that will handle incoming multipart HTTP requests. By    *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  * default as of v0.10, Sails uses                                          *</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  * [skipper](http://github.com/balderdashy/skipper). See                    *</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  * http://www.senchalabs.org/connect/multipart.html for other options.      *</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    // bodyParser: require('skipper')</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  // },</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  * The number of seconds to cache flat files on disk being served by        *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  * Express static middleware (by default, these files are in `.tmp/public`) *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  * The HTTP static cache is only active in a 'production' environment,      *</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  * since that's the only time Express will cache flat-files.                *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  // cache: 31557600000</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/i18n.js">/home/luiz/Projects/flashband/api/config/i18n.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Internationalization / Localization Settings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.i18n)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * If your app will touch people from all over the world, i18n (or internationalization)</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * may be an important part of your international strategy.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * For more informationom i18n in Sails, check out:</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/concepts/Internationalization</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * For a complete list of i18n options, see:</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * https://github.com/mashpie/i18n-node#list-of-configuration-options</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">module.exports.i18n = {</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  * Which locales are supported?                                             *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  // locales: ['en', 'es', 'fr', 'de']</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  * What is the default locale for the site? Note that this setting will be   *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  * overridden for any request that sends an &quot;Accept-Language&quot; header (i.e.   *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  * most browsers), but it's still useful if you need to localize the         *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  * response for requests made by non-browser clients (e.g. cURL).            *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  // defaultLocale: 'en',</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  * Automatically add new keys to locale (translation) files when they are    *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  * encountered during a request?                                             *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  // updateFiles: false,</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  * Path (relative to app root) of directory to store locale (translation)    *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  * files in.                                                                 *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  // localesDirectory: '/config/locales'</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/log.js">/home/luiz/Projects/flashband/api/config/log.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Built-in Log Configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.log)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Configure the log level for your app, as well as the transport</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * (Underneath the covers, Sails uses Winston for logging, which</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * allows for some pretty neat custom transports/adapters for log messages)</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * For more information on the Sails logger, check out:</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/concepts/Logging</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">module.exports.log = {</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  * Valid `level` configs: i.e. the minimum log level to capture with        *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  * sails.log.*()                                                            *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  * The order of precedence for log levels from lowest to highest is:        *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  * silly, verbose, info, debug, warn, error                                 *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  * You may also set the level to &quot;silent&quot; to suppress all logs.             *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  // level: 'info'</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/models.js">/home/luiz/Projects/flashband/api/config/models.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Default model configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.models)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Unless you override them, the following properties will be included</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * in each of your models.</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * For more info on Sails models, see:</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/concepts/ORM</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">module.exports.models = {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  * Your app's default connection. i.e. the name of one of your app's        *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  * connections (see `config/connections.js`)                                *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  connection: 'mongodbServer',</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  * How and whether Sails will attempt to automatically rebuild the          *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  * tables/collections/etc. in your schema.                                  *</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  * See http://sailsjs.org/#/documentation/concepts/ORM/model-settings.html  *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  // migrate: 'alter'</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/policies.js">/home/luiz/Projects/flashband/api/config/policies.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Policy Mappings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.policies)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Policies are simple functions which run **before** your controllers.</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * You can apply one or more policies to a given controller, or protect</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * its actions individually.</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Any policy file (e.g. `api/policies/authenticated.js`) can be accessed</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * below by its filename, minus the extension, (e.g. &quot;authenticated&quot;)</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * For more information on how policies work, see:</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/concepts/Policies</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * For more information on configuring policies, check out:</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.policies.html</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">module.exports.policies = {</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  * Default policy for all controllers and actions (`true` allows public     *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  * access)                                                                  *</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  '*': 'authenticated',</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  AuthenticateController: {</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    login: true,</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    authenticate: true</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  * Here's an example of mapping some policies to run before a controller    *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  * and its actions                                                          *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">	// RabbitController: {</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">		// Apply the `false` policy as the default for all of RabbitController's actions</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">		// (`false` prevents all access, which ensures that nothing bad happens to our rabbits)</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">		// '*': false,</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">		// For the action `nurture`, apply the 'isRabbitMother' policy</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">		// (this overrides `false` above)</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">		// nurture	: 'isRabbitMother',</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">		// Apply the `isNiceToAnimals` AND `hasRabbitFood` policies</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">		// before letting any users feed our rabbits</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">		// feed : ['isNiceToAnimals', 'hasRabbitFood']</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">	// }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/routes.js">/home/luiz/Projects/flashband/api/config/routes.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">2</td><td class="hits">1</td><td class="source">module.exports.routes = {</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  'post /frontdoor/enter': 'FrontdoorController.enter',</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  'post /frontdoor/leave': 'FrontdoorController.leave',</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  'post /frontdoor/cross': 'FrontdoorController.cross',</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  'post /login': 'AuthenticateController.login',</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  'post /authenticate': 'AuthenticateController.authenticate',</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  'put  /flashband/:tag/block': 'FlashbandController.block',</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  'get  /flashband/summary':    'FlashbandController.summary',</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  'post /flashband/enable':     'FlashbandController.enable',</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  'post /showgoer':         'ShowgoerController.create',</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  'get  /showgoer':         'ShowgoerController.find',</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  'get  /showgoer/search':  'ShowgoerController.search',</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  'get  /showgoer/summary': 'ShowgoerController.summary',</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  'post /showgoer/:showgoerId/associate/:tag': 'ShowgoerController.associate'</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/session.js">/home/luiz/Projects/flashband/api/config/session.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Session Configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.session)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Sails session integration leans heavily on the great work already done by</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * Express, but also unifies Socket.io with the Connect session store. It uses</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * Connect's cookie parser to normalize configuration differences between Express</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * and Socket.io and hooks into Sails' middleware interpreter to allow you to access</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * and auto-save to `req.session` with Socket.io the same way you would with Express.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * For more information on configuring the session, check out:</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.session.html</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">module.exports.session = {</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  * Session secret is automatically generated when your new app is created   *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  * Replace at your own risk in production-- you will invalidate the cookies *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  * of your users, forcing them to log in again.                             *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  secret: '671e062461a8a37188a5dfd7849f2421',</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  * Set the session cookie expire time The maxAge is set by milliseconds,    *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  * the example below is for 24 hours                                        *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  // cookie: {</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  //   maxAge: 24 * 60 * 60 * 1000</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  // }</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  * In production, uncomment the following lines to set up a shared redis    *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  * session store that can be shared across multiple Sails.js servers        *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  // adapter: 'redis',</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  * The following values are optional, if no options are set a redis         *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  * instance running on localhost is expected. Read more about options at:   *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  * https://github.com/visionmedia/connect-redis                             *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  // host: 'localhost',</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  // port: 6379,</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  // ttl: &lt;redis session TTL in seconds&gt;,</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  // db: 0,</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  // pass: &lt;redis auth password&gt;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  // prefix: 'sess:'</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  * Uncomment the following lines to use your Mongo adapter as a session     *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  * store                                                                    *</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  // adapter: 'mongo',</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  // host: 'localhost',</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  // port: 27017,</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  // db: 'sails',</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  // collection: 'sessions',</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  * Optional Values:                                                         *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  * # Note: url will override other connection settings url:                 *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  * 'mongodb://user:pass@host:port/database/collection',                     *</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  // username: '',</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  // password: '',</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  // auto_reconnect: false,</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  // ssl: false,</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">  // stringify: true</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/sockets.js">/home/luiz/Projects/flashband/api/config/sockets.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * WebSocket Server Settings</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.sockets)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * These settings provide transparent access to the options for Sails'</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * encapsulated WebSocket server, as well as some additional Sails-specific</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * configuration layered on top.</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * For more information on sockets configuration, including advanced config options, see:</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/reference/sails.config/sails.config.sockets.html</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">module.exports.sockets = {</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  * This custom onConnect function will be run each time AFTER a new socket  *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  * connects (To control whether a socket is allowed to connect, check out   *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  * `authorization` config.) Keep in mind that Sails' RESTful simulation for *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  * sockets mixes in socket.io events for your routes and blueprints         *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  * automatically.                                                           *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  onConnect: function(session, socket) {</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    // By default, do nothing.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  * This custom onDisconnect function will be run each time a socket         *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  * disconnects                                                              *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  onDisconnect: function(session, socket) {</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    // By default: do nothing.</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  * `transports`                                                             *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  * A array of allowed transport methods which the clients will try to use.  *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  * The flashsocket transport is disabled by default You can enable          *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  * flashsockets by adding 'flashsocket' to this list:                       *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  // transports: [</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  //   'websocket',</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  //   'htmlfile',</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  //   'xhr-polling',</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  //   'jsonp-polling'</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  // ],</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  * Use this option to set the datastore socket.io will use to manage        *</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  * rooms/sockets/subscriptions: default: memory                             *</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  // adapter: 'memory',</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  * Node.js (and consequently Sails.js) apps scale horizontally. It's a      *</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  * powerful, efficient approach, but it involves a tiny bit of planning. At *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  * scale, you'll want to be able to copy your app onto multiple Sails.js    *</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  * servers and throw them behind a load balancer.                           *</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  * One of the big challenges of scaling an application is that these sorts  *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  * of clustered deployments cannot share memory, since they are on          *</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  * physically different machines. On top of that, there is no guarantee     *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  * that a user will &quot;stick&quot; with the same server between requests (whether  *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  * HTTP or sockets), since the load balancer will route each request to the *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  * Sails server with the most available resources. However that means that  *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  * all room/pubsub/socket processing and shared memory has to be offloaded  *</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  * to a shared, remote messaging queue (usually Redis)                      *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">  * Luckily, Socket.io (and consequently Sails.js) apps support Redis for    *</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  * sockets by default. To enable a remote redis pubsub server, uncomment    *</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  * the config below.                                                        *</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  * Worth mentioning is that, if `adapter` config is `redis`, but host/port  *</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">  * is left unset, Sails will try to connect to redis running on localhost   *</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">  * via port 6379                                                            *</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  // adapter: 'redis',</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  // host: '127.0.0.1',</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  // port: 6379,</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  // db: 'sails',</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">  // pass: '&lt;redis auth password&gt;'</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  * `authorization`                                                          *</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  * Global authorization for Socket.IO access, this is called when the       *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">  * initial handshake is performed with the server.                          *</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  * By default (`authorization: false`), when a socket tries to connect,     *</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  * Sails allows it, every time. If no valid cookie was sent, a temporary    *</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">  * session will be created for the connecting socket.                       *</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">  * If `authorization: true`, before allowing a connection, Sails verifies   *</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">  * that a valid cookie was sent with the upgrade request. If the cookie     *</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">  * doesn't match any known user session, a new user session is created for  *</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">  * it. (In most cases, the user would already have a cookie since they      *</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  * loaded the socket.io client and the initial HTML page.)                  *</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">  * However, in the case of cross-domain requests, it is possible to receive *</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">  * a connection upgrade request WITHOUT A COOKIE (for certain transports)   *</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">  * In this case, there is no way to keep track of the requesting user       *</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  * between requests, since there is no identifying information to link      *</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">  * him/her with a session. The sails.io.js client solves this by connecting *</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  * to a CORS endpoint first to get a 3rd party cookie (fortunately this     *</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">  * works, even in Safari), then opening the connection.                     *</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">  * You can also pass along a ?cookie query parameter to the upgrade url,    *</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">  * which Sails will use in the absense of a proper cookie e.g. (when        *</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  * connection from the client):                                             *</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">  * io.connect('http://localhost:1337?cookie=smokeybear')                    *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">  * (Un)fortunately, the user's cookie is (should!) not accessible in        *</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  * client-side js. Using HTTP-only cookies is crucial for your app's        *</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">  * security. Primarily because of this situation, as well as a handful of   *</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  * other advanced use cases, Sails allows you to override the authorization *</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">  * behavior with your own custom logic by specifying a function, e.g:       *</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">  *    authorization: function authSocketConnectionAttempt(reqObj, cb) {     *</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">  *        // Any data saved in `handshake` is available in subsequent       *</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  *        requests from this as `req.socket.handshake.*`                    *</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">  *        // to allow the connection, call `cb(null, true)`                 *</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">  *        // to prevent the connection, call `cb(null, false)`              *</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">  *        // to report an error, call `cb(err)`                             *</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">  *     }                                                                    *</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">  // authorization: false,</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">  * Whether to run code which supports legacy usage for connected sockets    *</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">  * running the v0.9 version of the socket client SDK (i.e. sails.io.js).    *</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">  * Disabled in newly generated projects, but enabled as an implicit default *</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">  * (i.e. legacy usage/v0.9 clients be supported if this property is set to  *</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">  * true, but also if it is removed from this configuration file or set to   *</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">  * `undefined`)                                                             *</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  // 'backwardsCompatibilityFor0.9SocketClients': false,</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">  * Whether to expose a 'get /__getcookie' route with CORS support that sets *</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">  * a cookie (this is used by the sails.io.js socket client to get access to *</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">  * a 3rd party cookie and to enable sessions).                              *</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">  * Warning: Currently in this scenario, CORS settings apply to interpreted  *</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">  * requests sent via a socket.io connection that used this cookie to        *</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">  * connect, even for non-browser clients! (e.g. iOS apps, toasters, node.js *</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">  * unit tests)                                                              *</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">  // grant3rdPartyCookie: true,</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">  /***************************************************************************</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">  * Match string representing the origins that are allowed to connect to the *</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">  * Socket.IO server                                                         *</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">  *                                                                          *</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">  ***************************************************************************/</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">  // origins: '*:*',</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/config/views.js">/home/luiz/Projects/flashband/api/config/views.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * View Engine Configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (sails.config.views)</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Server-sent views are a classic and effective way to get your app up</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * and running. Views are normally served from controllers.  Below, you can</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * configure your templating language/framework of choice and configure</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * Sails' layout support.</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * For more information on views and layouts, check out:</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * http://sailsjs.org/#/documentation/concepts/Views</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">module.exports.views = {</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  * View engine (aka template language) to use for your app's *server-side*   *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  * views                                                                     *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  * Sails+Express supports all view engines which implement TJ Holowaychuk's  *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  * `consolidate.js`, including, but not limited to:                          *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  * ejs, jade, handlebars, mustache underscore, hogan, haml, haml-coffee,     *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  * dust atpl, eco, ect, jazz, jqtpl, JUST, liquor, QEJS, swig, templayed,    *</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  * toffee, walrus, &amp; whiskers                                                *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  * For more options, check out the docs:                                     *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  * https://github.com/balderdashy/sails-wiki/blob/0.9/config.views.md#engine *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  engine: 'ejs',</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  * Layouts are simply top-level HTML templates you can use as wrappers for   *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  * your server-side views. If you're using ejs or jade, you can take         *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  * advantage of Sails' built-in `layout` support.                            *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  * When using a layout, when one of your views is served, it is injected     *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  * into the `body` partial defined in the layout. This lets you reuse header *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  * and footer logic between views.                                           *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  * NOTE: Layout support is only implemented for the `ejs` view engine!       *</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  *       For most other engines, it is not necessary, since they implement   *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  *       partials/layouts themselves. In those cases, this config will be    *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  *       silently ignored.                                                   *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  * The `layout` setting may be set to one of the following:                  *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  * If `false`, layouts will be disabled. Otherwise, if a string is           *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  * specified, it will be interpreted as the relative path to your layout     *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  * file from `views/` folder. (the file extension, &quot;.ejs&quot;, should be         *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  * omitted)                                                                  *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  layout: 'layout'</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  /****************************************************************************</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  * Using Multiple Layouts with EJS                                           *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  * If you're using the default engine, `ejs`, Sails supports the use of      *</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  * multiple `layout` files. To take advantage of this, before rendering a    *</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  * view, override the `layout` local in your controller by setting           *</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  * `res.locals.layout`. (this is handy if you parts of your app's UI look    *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  * completely different from each other)                                     *</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  * e.g. your default might be                                                *</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  * layout: 'layouts/public'                                                  *</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  * But you might override that in some of your controllers with:             *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  * layout: 'layouts/internal'                                                *</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  *                                                                           *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  ****************************************************************************/</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/bootstrap.test.js">/home/luiz/Projects/flashband/api/test/bootstrap.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">9</div><div class="hits">9</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var Sails = require('sails');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var databaseHelper = require('./helpers/DatabaseHelper');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">before(function(done) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  Sails.lift({</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    silent: true,</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    models: {</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">      migrate: 'drop'</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  }, done);</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">97</td><td class="source">  databaseHelper.emptyModels(sails.models).finally(done);</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">after(function(done) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">  sails.lower(done);</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/DatabaseHelper.js">/home/luiz/Projects/flashband/api/test/helpers/DatabaseHelper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">14</div><div class="hits">14</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var aSync = require('async');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var q = require('q');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  emptyModels: function(models, callback) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">149</td><td class="source">    var defer = q.defer();</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">149</td><td class="source">    aSync.each(models, function(model, next) {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">87</td><td class="source">      model.count().exec(function(err, count) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">87</td><td class="source">        if (err) { return next(err); }</td></tr><tr class="hit"><td class="line">13</td><td class="hits">141</td><td class="source">        if (count) { return model.destroy().exec(next); }</td></tr><tr class="hit"><td class="line">14</td><td class="hits">33</td><td class="source">        next();</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    }, function(err, results) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">149</td><td class="source">      if (callback) { callback(err, results); }</td></tr><tr class="hit"><td class="line">18</td><td class="hits">149</td><td class="source">      if (err) { return defer.reject(err); }</td></tr><tr class="hit"><td class="line">19</td><td class="hits">149</td><td class="source">      defer.resolve(results);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">149</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/FlashbandBatchHelper.js">/home/luiz/Projects/flashband/api/test/helpers/FlashbandBatchHelper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">3</div><div class="hits">3</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  createActive: function(name) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">    return FlashbandBatch.create({name: name, active: true});</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/FlashbandHelper.js">/home/luiz/Projects/flashband/api/test/helpers/FlashbandHelper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">17</div><div class="hits">17</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var q = require('q');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var prepareArgs = function(tag, serial, blockedAt) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">34</td><td class="source">  var newTag = tag ? tag : ''.concat((new Date()).getTime());</td></tr><tr class="hit"><td class="line">6</td><td class="hits">34</td><td class="source">  var newSerial = serial ? serial : 1;</td></tr><tr class="hit"><td class="line">7</td><td class="hits">34</td><td class="source">  return {tag: newTag, serial: newSerial, blockedAt: blockedAt};</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  createBlocked: function(tag, serial) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">5</td><td class="source">    var defer = q.defer();</td></tr><tr class="hit"><td class="line">13</td><td class="hits">5</td><td class="source">    var args = prepareArgs(tag, serial, new Date());</td></tr><tr class="hit"><td class="line">14</td><td class="hits">5</td><td class="source">    Flashband.create(args).then(function(flashband) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">5</td><td class="source">      defer.resolve(flashband);</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">17</td><td class="hits">5</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  createSuccess: function(tag, serial) {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">29</td><td class="source">    var defer = q.defer();</td></tr><tr class="hit"><td class="line">22</td><td class="hits">29</td><td class="source">    var args = prepareArgs(tag, serial, null);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">29</td><td class="source">    Flashband.create(args).then(function(flashband) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">29</td><td class="source">      defer.resolve(flashband);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">26</td><td class="hits">29</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/FrontdoorHelper.js">/home/luiz/Projects/flashband/api/test/helpers/FrontdoorHelper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">15</div><div class="hits">15</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var fbHelp = require('./FlashbandHelper');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  createEntrance: function() {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">14</td><td class="source">    return fbHelp.createSuccess().then(function(flashSuccess) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">14</td><td class="source">      return Entrance.create({tag: flashSuccess.tag});</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  createEntranceAndBlocked: function() {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">3</td><td class="source">    return this.createEntrance().then(function(entrance) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">3</td><td class="source">      return Flashband.findOne({tag: entrance.tag}).then(function(flashband) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">3</td><td class="source">        flashband.blockedAt = new Date();</td></tr><tr class="hit"><td class="line">16</td><td class="hits">3</td><td class="source">        return flashband.save(function(err, mdl) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">3</td><td class="source">          return mdl;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  createLeave: function() {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">5</td><td class="source">    var leave = function(entrance) {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">5</td><td class="source">      entrance.leave = new Date();</td></tr><tr class="hit"><td class="line">26</td><td class="hits">5</td><td class="source">      return entrance.save(function(err, mdl) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">5</td><td class="source">        return mdl;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">5</td><td class="source">    return this.createEntrance().then(leave);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/ShowgoerHelper.js">/home/luiz/Projects/flashband/api/test/helpers/ShowgoerHelper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">9</div><div class="hits">9</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var q = require('q');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  create: function(params) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">10</td><td class="source">    var defer = q.defer();</td></tr><tr class="hit"><td class="line">8</td><td class="hits">10</td><td class="source">    var defaultShowgoer = { name: 'Fulano de Tal', docType: 'cpf', docNumber: new Date() };</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">10</td><td class="source">    Showgoer.create(params || defaultShowgoer).exec(function(err, showgoer) {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">10</td><td class="source">      if (err) { return defer.reject(err); }</td></tr><tr class="hit"><td class="line">12</td><td class="hits">10</td><td class="source">      defer.resolve(showgoer);</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">14</td><td class="hits">10</td><td class="source">    return defer.promise;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/StringReadableStream.js">/home/luiz/Projects/flashband/api/test/helpers/StringReadableStream.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">17</div><div class="hits">17</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var Readable = require('stream').Readable;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var util = require('util');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var StringReadableStream = function(content, opt) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">10</td><td class="source">  Readable.call(this, opt);</td></tr><tr class="hit"><td class="line">8</td><td class="hits">10</td><td class="source">  this._max = 1;</td></tr><tr class="hit"><td class="line">9</td><td class="hits">10</td><td class="source">  this._index = 1;</td></tr><tr class="hit"><td class="line">10</td><td class="hits">10</td><td class="source">  this.content = content;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">util.inherits(StringReadableStream, Readable);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">StringReadableStream.prototype._read = function() {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">20</td><td class="source">  var i = this._index++;</td></tr><tr class="hit"><td class="line">17</td><td class="hits">20</td><td class="source">  if (i &gt; this._max) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">10</td><td class="source">    this.push(null);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">10</td><td class="source">    var buf = new Buffer(this.content, 'utf8');</td></tr><tr class="hit"><td class="line">21</td><td class="hits">10</td><td class="source">    this.push(buf);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  createReadableStream: function(content, opts) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">10</td><td class="source">    return new StringReadableStream(content, opts);</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/helpers/UserHelper.js">/home/luiz/Projects/flashband/api/test/helpers/UserHelper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">3</div><div class="hits">3</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  createAnonymous: function() {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">2</td><td class="source">    return User.create({</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">      email: 'addadmin@flashband.com',</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">      mobpassword: '222222',</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">      webpassword: '333333'</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/integration/controllers/AuthenticateController.test.js">/home/luiz/Projects/flashband/api/test/integration/controllers/AuthenticateController.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">32</div><div class="hits">32</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var request = require('supertest');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var shared = require('../shared-specs');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var UserHelper = require('../../helpers/UserHelper');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">describe('AuthenticateController', function() {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">  shared.shoudRequestNotFound('/login', ['GET', 'PUT', 'DELETE']);</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">  shared.shoudRequestNotFound('/authenticate', ['GET', 'PUT', 'DELETE']);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">  describe('POST /authenticate', function() {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">    it('should allow authentication with valid user data', function (done) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">      var verifyAuthenticate = function(err, user) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">        if (err)   { return done(err);  }</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">        if (!user) { return done(user); }</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">          .post('/authenticate')</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">          .send({password: user.mobpassword})</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">          .expect(202)</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">          .end(function(err, res) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">            expect(res.body).to.have.property('token').and.is.a('string').and.match(/^sha1.*/);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">            expect(res.body).to.have.property('user').and.is.a('object').and.to.have.property('email', user.email);</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">            done(err);</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">      UserHelper.createAnonymous().exec(verifyAuthenticate);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">    it('should deny authentication with invalid user data', function (done) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">      request(sails.hooks.http.app)</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">      .post('/authenticate')</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">      .send({password: 'invalidPassword'})</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">      .expect(401)</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">      .expect('Content-Type', /application\/json/)</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">      .end(done);</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">  describe('POST /login', function() {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">    it('should allow with valid user data', function (done) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">      var verifyAuthenticate = function(err, user) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">        if (err)   { return done(err);  }</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">        if (!user) { return done(user); }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">          .post('/login')</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">          .send({email: user.email, password: user.webpassword})</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">          .expect(202)</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">          .end(function(err, res) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">            expect(res.body).to.have.property('token').and.is.a('string').and.match(/^sha1.*/);</td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">            expect(res.body).to.have.property('user').and.is.a('object').and.to.have.property('email', user.email);</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">            done(err);</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">1</td><td class="source">      UserHelper.createAnonymous().exec(verifyAuthenticate);</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">    it('should deny login with invalid user data', function (done) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">      request(sails.hooks.http.app)</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">        .post('/login')</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">        .send({email: 'admin@flashband.com', password: 'invalidPassword'})</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">        .expect(401)</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">        .expect('Content-Type', /application\/json/)</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">        .end(done);</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/integration/controllers/FlashbandController.test.js">/home/luiz/Projects/flashband/api/test/integration/controllers/FlashbandController.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">47</div><div class="hits">47</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var request = require('supertest');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var shared  = require('../shared-specs');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var pwHash  = require('password-hash');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var fbHelp  = require('../../helpers/FlashbandHelper');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var dbHelp  = require('../../helpers/DatabaseHelper');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var expect  = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">describe('FlashbandController', function() {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">  var serialToken;</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">  shared.shoudRequestNotFound('/flashband/000000000000/block', ['GET', 'POST', 'DELETE']);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  //shared.shoudRequestNotFound('/flashband/enable', ['PUT', 'DELETE']);</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">  describe('with authenticated user', function() {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">    beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">7</td><td class="source">      User.create({password: '123123123'}).exec(function(err, user) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">7</td><td class="source">        if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">20</td><td class="hits">7</td><td class="source">        serialToken = pwHash.generate(user.id);</td></tr><tr class="hit"><td class="line">21</td><td class="hits">7</td><td class="source">        user.tokens.add({ token: serialToken });</td></tr><tr class="hit"><td class="line">22</td><td class="hits">7</td><td class="source">        user.save().then(function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">7</td><td class="source">          dbHelp.emptyModels([Flashband, FlashbandBatch]).then(done).fail(done);</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">    describe('PUT /flashband/{tag}/block', function() {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">      it ('should block an existing flashband', function(done) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">        fbHelp.createSuccess().then(function(validFlashband) {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">            .put('/flashband/' + validFlashband.tag + '/block')</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">            .expect(200, { message: 'Flashband blocked.' })</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">            .end(done);</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">      it('should not found a non existing flashband', function(done) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">          .put('/flashband/000000000000/block')</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">          .expect(403, 'Flashband not found.')</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">      it('should not found an already blocked flashband', function(done) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">        fbHelp.createBlocked().then(function(validFlashband) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">            .put('/flashband/' + validFlashband.tag + '/block')</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">            .expect(403, 'Flashband already blocked.')</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">            .end(done);</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">    describe('POST /flashband/enable', function() {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">      var importBatch;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">1</td><td class="source">      beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">3</td><td class="source">        importBatch = function(nameBatch, attachFile) {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">4</td><td class="source">          return request(sails.hooks.http.app)</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">            .post('/flashband/enable')</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">            .attach('flashbands', 'test/fixtures/'.concat(attachFile))</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">            .send({name: nameBatch})</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken));</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">        };</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">3</td><td class="source">        done();</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">      it ('should enable flashbands from valid file', function(done) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">        importBatch('1st flashband batch', 'one-valid-flashband.csv')</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">          .expect(201, { flashbandsEnabled: 1, message: 'Flashbands enabled successfully.' })</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">      it ('should reject corrupted file (flashband without UID) ', function(done) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">        importBatch('2st flashband batch', 'flashband-without-uid.csv')</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">          .expect(400)</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">      it ('should delete old flashbands when enable a new batch', function(done) {</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">        var flashbandNumber = '8028533A0A830488';</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">90</td><td class="hits">1</td><td class="source">        importBatch('3st flashband batch', 'one-valid-flashband.csv').end(function() {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">          expect(FlashbandService.exists(flashbandNumber)).to.eventually.have.property('tag', flashbandNumber).and.notify(function() {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">            importBatch('4st flashband batch', 'two-valid-flashband.csv').end(function() {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">              expect(FlashbandService.exists(flashbandNumber)).to.be.rejectedWith('Flashband not found').and.notify(done);</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">    describe('GET /flashband/enable', function() {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">      it('should return total of enabled flashbands', function(done) {</td></tr><tr class="hit"><td class="line">102</td><td class="hits">1</td><td class="source">        fbHelp.createSuccess().then(function() {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">            .get('/flashband/summary')</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">            .expect(200, { total: 1 })</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">            .expect('Content-Type', /application\/json/)</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">            .end(done);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/integration/controllers/FrontdoorController.test.js">/home/luiz/Projects/flashband/api/test/integration/controllers/FrontdoorController.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">83</div><div class="hits">83</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var request = require('supertest');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var shared  = require('../shared-specs');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var pwHash  = require('password-hash');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var fbHelp  = require('../../helpers/FlashbandHelper');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var fdHelp  = require('../../helpers/FrontdoorHelper');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var dbHelp  = require('../../helpers/DatabaseHelper');</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var outputSuccessful;</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var inputSuccessful;</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var args;</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var serialToken;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">describe('FrontdoorController', function() {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">  beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">21</td><td class="source">    args = {tag: '1234'};</td></tr><tr class="hit"><td class="line">18</td><td class="hits">21</td><td class="source">    dbHelp.emptyModels([Entrance, Flashband]).then(function() {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">21</td><td class="source">      inputSuccessful  = {door: 'in', message: 'Input successful.'};</td></tr><tr class="hit"><td class="line">20</td><td class="hits">21</td><td class="source">      outputSuccessful = {door: 'out', message: 'Output successful.'};</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">21</td><td class="source">      User.create({password: '123123123'}).then(function(user) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">21</td><td class="source">        serialToken = pwHash.generate(user.id);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">21</td><td class="source">        user.tokens.add({ token: serialToken });</td></tr><tr class="hit"><td class="line">25</td><td class="hits">21</td><td class="source">        user.save(done);</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">      }).fail(done);</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">  describe('POST /frontdoor/enter', function() {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">    shared.shoudRequestNotFound('/frontdoor/enter', ['GET', 'PUT', 'DELETE']);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">    it('should register a valid flashband', function (done) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">      var verifyRegister = function(flashband) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">          .post('/frontdoor/enter')</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">          .send({tag: flashband.tag})</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">          .expect(201, inputSuccessful)</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">      fbHelp.createSuccess().then(verifyRegister);</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">    it('should reject a invalid flashband', function (done) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">      request(sails.hooks.http.app)</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">        .post('/frontdoor/enter')</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">        .send({tag: '123123123123'})</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">        .expect(403, 'Flashband not found.')</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">        .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">        .end(done);</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">    it('should reject duplicated flashband', function (done) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">      var verifyDuplicated = function(entrance) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">          .post('/frontdoor/enter')</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">          .expect(403, 'Duplicated entrance.')</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">      fdHelp.createEntrance().then(verifyDuplicated, done);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">    it('should reject blocked flashband', function (done) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">      var verifyFlashBandBlocked = function(flashBlocked ) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">          .post('/frontdoor/enter')</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">          .send({tag: flashBlocked.tag})</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">          .expect(403, 'Blocked flashband.')</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">      fbHelp.createBlocked().then(verifyFlashBandBlocked);</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">  describe('POST /frontdoor/leave', function() {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">    shared.shoudRequestNotFound('/frontdoor/leave', ['GET', 'PUT', 'DELETE']);</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">    it('should leave a valid flashband', function (done) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">      var verifyLeave = function(entrance) {</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">          .post('/frontdoor/leave')</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">          .expect(201, outputSuccessful)</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">      fdHelp.createEntrance().then(verifyLeave, done);</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">    it('should reject a invalid flashband', function (done) {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">      request(sails.hooks.http.app)</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">        .post('/frontdoor/leave')</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">        .send({tag: '123123123123'})</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">        .expect(403, 'Flashband not found.')</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">        .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">        .end(done);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">    it('should reject blocked flashband', function (done) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">      var verifyFlashBandBlocked = function(entrance) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">          .post('/frontdoor/leave')</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">          .expect(403, 'Blocked flashband.')</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">      fdHelp.createEntranceAndBlocked().then(verifyFlashBandBlocked, done);</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">    it('should reject duplicated flashband', function (done) {</td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">      var verifyDuplicated = function(entrance) {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">          .post('/frontdoor/leave')</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">          .expect(403, 'Duplicated exit.')</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">132</td><td class="hits">1</td><td class="source">      fdHelp.createLeave().then(verifyDuplicated, done);</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">  describe('POST /frontdoor/cross', function() {</td></tr><tr class="hit"><td class="line">137</td><td class="hits">1</td><td class="source">    it('should register a valid flashband', function (done) {</td></tr><tr class="hit"><td class="line">138</td><td class="hits">1</td><td class="source">      var verifyRegister = function(flashband) {</td></tr><tr class="hit"><td class="line">139</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">          .post('/frontdoor/cross')</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">          .send({tag: flashband.tag})</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">          .expect(201, inputSuccessful)</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">148</td><td class="hits">1</td><td class="source">      fbHelp.createSuccess().then(verifyRegister);</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">151</td><td class="hits">1</td><td class="source">    it('should leave a valid flashband', function (done) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">      var verifyLeave = function(entrance) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">          .post('/frontdoor/cross')</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">          .expect(201, outputSuccessful)</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">162</td><td class="hits">1</td><td class="source">      fdHelp.createEntrance().then(verifyLeave, done);</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">165</td><td class="hits">1</td><td class="source">    it('should reject a invalid flashband', function (done) {</td></tr><tr class="hit"><td class="line">166</td><td class="hits">1</td><td class="source">      request(sails.hooks.http.app)</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">        .post('/frontdoor/cross')</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">        .send({tag: '123123123123'})</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">        .expect(403, 'Flashband not found.')</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">        .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">        .end(done);</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">174</td><td class="hits">1</td><td class="source">    it('should reject blocked flashband', function (done) {</td></tr><tr class="hit"><td class="line">175</td><td class="hits">1</td><td class="source">      var verifyFlashBandBlocked = function(entrance) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">          .post('/frontdoor/cross')</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">          .expect(403, 'Blocked flashband.')</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">184</td><td class="hits">1</td><td class="source">      fdHelp.createEntranceAndBlocked().then(verifyFlashBandBlocked, done);</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">187</td><td class="hits">1</td><td class="source">    it('should register a valid flashband after exit', function (done) {</td></tr><tr class="hit"><td class="line">188</td><td class="hits">1</td><td class="source">      var verifyRegister = function(entrance) {</td></tr><tr class="hit"><td class="line">189</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">          .post('/frontdoor/cross')</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">          .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">          .expect(201, inputSuccessful)</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">198</td><td class="hits">1</td><td class="source">      fdHelp.createLeave().then(verifyRegister);</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">201</td><td class="hits">1</td><td class="source">    it('should register output after entering 2x', function (done) {</td></tr><tr class="hit"><td class="line">202</td><td class="hits">1</td><td class="source">      var verifyRegister = function(entrance) {</td></tr><tr class="hit"><td class="line">203</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">          .post('/frontdoor/cross')</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">          .end(function() {</td></tr><tr class="hit"><td class="line">208</td><td class="hits">1</td><td class="source">            request(sails.hooks.http.app)</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">              .post('/frontdoor/cross')</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">              .send({tag: entrance.tag})</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">              .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">              .expect(201, outputSuccessful)</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">              .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">              .end(done);</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">218</td><td class="hits">1</td><td class="source">      fdHelp.createLeave().then(verifyRegister);</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">221</td><td class="hits">1</td><td class="source">    it('must register the entry after leaving 2x', function (done) {</td></tr><tr class="hit"><td class="line">222</td><td class="hits">1</td><td class="source">      var verifyRegister = function(entrance) {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">          .post('/frontdoor/cross')</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">          .send({tag: entrance.tag})</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">          .end(function() {</td></tr><tr class="hit"><td class="line">228</td><td class="hits">1</td><td class="source">            request(sails.hooks.http.app)</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">              .post('/frontdoor/cross')</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">              .send({tag: entrance.tag})</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">              .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">              .end(function() {</td></tr><tr class="hit"><td class="line">233</td><td class="hits">1</td><td class="source">                request(sails.hooks.http.app)</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">                  .post('/frontdoor/cross')</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">                  .send({tag: entrance.tag})</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">                  .expect('Content-type', /application\/json/)</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">                  .expect(201, inputSuccessful)</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">                  .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">                  .end(done);</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">              });</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">244</td><td class="hits">1</td><td class="source">      fdHelp.createLeave().then(verifyRegister);</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/integration/controllers/ShowgoerController.test.js">/home/luiz/Projects/flashband/api/test/integration/controllers/ShowgoerController.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">84</div><div class="hits">84</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var request        = require('supertest');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var passwordHash   = require('password-hash');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var expect         = require('chai').expect;</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var ShowgoerHelper = require('../../helpers/ShowgoerHelper');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var databaseHelper = require('../../helpers/DatabaseHelper');</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">describe('ShowgoerController', function() {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">  var serialToken;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">  describe('with authenticated user', function() {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">    beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">5</td><td class="source">      User.create({password: '123123123'}).exec(function(err, user) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">5</td><td class="source">        if (err) { return done(err); }</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">5</td><td class="source">        serialToken = passwordHash.generate(user.id);</td></tr><tr class="hit"><td class="line">18</td><td class="hits">5</td><td class="source">        user.tokens.add({ token: serialToken });</td></tr><tr class="hit"><td class="line">19</td><td class="hits">5</td><td class="source">        user.save().then(function() {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">5</td><td class="source">          databaseHelper.emptyModels([Showgoer]).then(done).fail(done);</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">    describe('GET /showgoer', function() {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">      it ('should be ok', function(done) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">        request(sails.hooks.http.app)</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">          .get('/showgoer/')</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">          .expect('Content-Type', /application\/json/)</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">          .expect(200)</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">          .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">          .end(done);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">      it ('should list showgoers', function(done) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">        ShowgoerHelper.create({ name: 'Fulano de Tal', docType: 'cpf', docNumber: '111.111.111-11' }).then(function() {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">            .get('/showgoer/')</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">            .end(function(err, res) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">              if (err) { return done(err); }</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">              var showgoers = res.body;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">              expect(showgoers).to.have.length(1, 'Wrong number of showgoers');</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">              var showgoer = showgoers[0];</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('name', 'Fulano de Tal');</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docType', 'cpf');</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docNumber', '111.111.111-11');</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('id');</td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('createdAt');</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('updatedAt');</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">              done();</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">      it ('should filter by name', function(done) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">        var showgoer1 = { name: 'Fulano de Tal', docType: 'cpf', docNumber: '222.222.222-22' };</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">        var showgoer2 = { name: 'Beltrano de Tal', docType: 'cpf', docNumber: '333.333.333-33' };</td></tr><tr class="hit"><td class="line">61</td><td class="hits">1</td><td class="source">        var searchTerm = 'Beltrano de Tal';</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">        ShowgoerHelper.create([showgoer1, showgoer2]).then(function() {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">            .get('/showgoer/search/?s=' + searchTerm)</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">            .end(function(err, res) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">              if (err) { return done(err); }</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">              var showgoers = res.body;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">              expect(showgoers).to.have.length(1, 'Wrong number of showgoers');</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">              var showgoer = showgoers[0];</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('name', 'Beltrano de Tal');</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docType', 'cpf');</td></tr><tr class="hit"><td class="line">75</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docNumber', '333.333.333-33');</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('id');</td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('createdAt');</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('updatedAt');</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">              done();</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">      it ('should filter by name containing search term and case insensitive', function(done) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">1</td><td class="source">        var showgoer1 = { name: 'Fulano de Tal', docType: 'cpf', docNumber: '222.222.222-22' };</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">        var showgoer2 = { name: 'Beltrano de Tal', docType: 'cpf', docNumber: '333.333.333-33' };</td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">        var searchTerm = 'ULAN';</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">        ShowgoerHelper.create([showgoer1, showgoer2]).then(function() {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">            .get('/showgoer/search/?s=' + searchTerm)</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">            .end(function(err, res) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">              if (err) { return done(err); }</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">1</td><td class="source">              var showgoers = res.body;</td></tr><tr class="hit"><td class="line">96</td><td class="hits">1</td><td class="source">              expect(showgoers).to.have.length(1, 'Wrong number of showgoers');</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">              var showgoer = showgoers[0];</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('name', 'Fulano de Tal');</td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docType', 'cpf');</td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docNumber', '222.222.222-22');</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('id');</td></tr><tr class="hit"><td class="line">102</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('createdAt');</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('updatedAt');</td></tr><tr class="hit"><td class="line">104</td><td class="hits">1</td><td class="source">              done();</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">      it ('should filter by document number containing search term and case insensitive', function(done) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">        var showgoer1 = { name: 'Fulano de Tal', docType: 'cpf', docNumber: '222.222.222-22' };</td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">        var showgoer2 = { name: 'Beltrano de Tal', docType: 'cpf', docNumber: '333.333.333-33' };</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">        var searchTerm = '222.222.222-22';</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">        ShowgoerHelper.create([showgoer1, showgoer2]).then(function() {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">1</td><td class="source">          request(sails.hooks.http.app)</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">            .get('/showgoer/search/?s=' + searchTerm)</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">            .set('Authorization', 'Token token='.concat(serialToken))</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">            .end(function(err, res) {</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">              if (err) { return done(err); }</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">121</td><td class="hits">1</td><td class="source">              var showgoers = res.body;</td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">              expect(showgoers).to.have.length(1, 'Wrong number of showgoers');</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">124</td><td class="hits">1</td><td class="source">              var showgoer = showgoers[0];</td></tr><tr class="hit"><td class="line">125</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('name', 'Fulano de Tal');</td></tr><tr class="hit"><td class="line">126</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docType', 'cpf');</td></tr><tr class="hit"><td class="line">127</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('docNumber', '222.222.222-22');</td></tr><tr class="hit"><td class="line">128</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('id');</td></tr><tr class="hit"><td class="line">129</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('createdAt');</td></tr><tr class="hit"><td class="line">130</td><td class="hits">1</td><td class="source">              expect(showgoer).to.have.property('updatedAt');</td></tr><tr class="hit"><td class="line">131</td><td class="hits">1</td><td class="source">              done();</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/integration/shared-specs.js">/home/luiz/Projects/flashband/api/test/integration/shared-specs.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">7</div><div class="hits">7</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var aSync = require('async');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var request = require('supertest');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">module.exports.shoudRequestNotFound = function(path, verbs) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">5</td><td class="source">  aSync.map(verbs, function(verb) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">15</td><td class="source">    it ('should request not found (404) on ' + verb + ' ' + path, function(done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">15</td><td class="source">      request(sails.hooks.http.app)</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">        .get(path)</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">        .expect(404, done);</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/models/Flashband.test.js">/home/luiz/Projects/flashband/api/test/unit/models/Flashband.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">16</div><div class="hits">16</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').expect;</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">describe('Flashband model', function() {</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">  var flashband = null;</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">  beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">2</td><td class="source">    flashband = new Flashband._model({tag: '9876', serial: 1});</td></tr><tr class="hit"><td class="line">10</td><td class="hits">2</td><td class="source">    done();</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">  describe('#blocked', function() {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">    it('should be false when blockedAt is not set', function(done) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">      flashband.blockedAt = null;</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">      expect(flashband.blocked()).to.be.eql(false);</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">    it('should be true when blockedAt is set', function(done) {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">      flashband.blockedAt = new Date();</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">      expect(flashband.blocked()).to.be.eql(true);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/flashband/associate.test.js">/home/luiz/Projects/flashband/api/test/unit/services/flashband/associate.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">33</div><div class="hits">33</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var fbHelp = require('../../../helpers/FlashbandHelper');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var sgHelp = require('../../../helpers/ShowgoerHelper');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">describe('FlashbandService', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">  describe('#associate', function() {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">    it('should associate a showgoer', function shouldAssociateShowgoer(done) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">      sgHelp.create().then(function afterShowgoerCreate(showgoer) {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">        fbHelp.createSuccess().then(function expectAssociateShowGoer(flashband) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">          expect(ShowgoerService.associate(showgoer.id, flashband.tag)).to.eventually.have.property('showgoer', showgoer.id).and.notify(done);</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">        }, done);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">      }, done);</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">    it('should reject a flashband blocked', function shouldRejectFlashbandBlocked(done) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">      sgHelp.create().then(function afterShowgoerCreate(showgoer) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">        fbHelp.createBlocked().then(function expectRejectFlashbandBlocked(flashband) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">          expect(ShowgoerService.associate(showgoer.id, flashband.tag)).to.be.rejectedWith('Blocked Flashband').and.notify(done);</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">        }, done);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">      }, done);</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">    it('should reject a showgoer ever associated', function shouldRejectShowgoerEverAssociated(done) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">      sgHelp.create().then(function afterShowgoerCreate(showgoer) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">        fbHelp.createSuccess().then(function expectAssociateShowGoer(flashband) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">          ShowgoerService.associate(showgoer.id, flashband.tag).then(function(associated) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">            fbHelp.createSuccess().then(function expectAssociateShowGoer(newFlashband) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">              expect(ShowgoerService.associate(associated.showgoer, newFlashband.tag)).to.be.rejectedWith('Showgoer ever associated').and.notify(done);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">            }, done);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">          }, done);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">        }, done);</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">      }, done);</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">    it('should reject a flashband ever associated', function shouldRejectShowgoerEverAssociated(done) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">      sgHelp.create().then(function afterShowgoerCreate(showgoer) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">        fbHelp.createSuccess().then(function expectAssociateShowGoer(flashband) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">          ShowgoerService.associate(showgoer.id, flashband.tag).then(function(associated) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">            sgHelp.create().then(function afterShowgoerCreate(newShowgoer) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">              expect(ShowgoerService.associate(newShowgoer.id, associated.tag)).to.be.rejectedWith('Flashband ever associated').and.notify(done);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">            }, done);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">          }, done);</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">        }, done);</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">      }, done);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">    it('should associate a new flashband when old flashband be blocked', function shouldRejectFlashbandBlocked(done) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">      sgHelp.create().then(function afterShowgoerCreate(showgoer) {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">        fbHelp.createSuccess().then(function rejectFlashbandBlocked(flashband) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">          ShowgoerService.associate(showgoer.id, flashband.tag).then(function(associated) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">            FlashbandService.block(associated.tag).then(function() { //function(blocked)</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">              fbHelp.createSuccess().then(function expectAssociateShowGoer(newFlashband) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">                expect(ShowgoerService.associate(showgoer.id, newFlashband.tag)).to.eventually.have.property('showgoer', showgoer.id).and.notify(done);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">              }, done);</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">            }, done);</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">          }, done);</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">        }, done);</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">      }, done);</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/flashband/blocked.test.js">/home/luiz/Projects/flashband/api/test/unit/services/flashband/blocked.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">22</div><div class="hits">22</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var fbHelp = require('../../../helpers/FlashbandHelper');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">describe('FlashbandService', function() {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  describe('#block', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">    it('should set flashband blockedAt', function(done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">      fbHelp.createSuccess().then(function(flashband) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">        expect(FlashbandService.block(flashband.tag))</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">        .to.eventually.have.property('blockedAt')</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">        .and.be.ok</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">        .and.notify(function(err) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">          if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">          expect(Flashband.findOne({ tag: flashband.tag }))</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">          .to.eventually.have.property('blockedAt')</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">          .and.be.ok.and.notify(done);</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">      }).fail(done);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">    it('should not allow blocking a non-existing flashband', function(done) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">      expect(FlashbandService.block('non-existing'))</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">        .to.be.rejectedWith('Flashband not found.')</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">        .and.notify(done);</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">    it('should not block an already blocked flashband', function(done) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">      fbHelp.createBlocked().then(function(blockedFlashband) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">        var originalBlockedAt = blockedFlashband.blockedAt;</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">        expect(FlashbandService.block(blockedFlashband.tag))</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">        .to.be.rejectedWith('Flashband already blocked.')</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">        .and.notify(function(err) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">          if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">          Flashband.findOne({tag: blockedFlashband.tag}).exec(function(err, flashband) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">            if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">            if (!flashband) { throw 'saved flashband not found! :-/'; }</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">            expect(flashband.blockedAt).to.eql(originalBlockedAt);</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">            done();</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">      }).fail(done);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/flashband/enable.test.js">/home/luiz/Projects/flashband/api/test/unit/services/flashband/enable.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">60</div><div class="hits">60</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var databaseHelper = require('../../../helpers/DatabaseHelper');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var flashbandBatchHelper = require('../../../helpers/FlashbandBatchHelper');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var flashbandHelper = require('../../../helpers/FlashbandHelper');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">describe('FlashbandService', function() {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">  describe('#enable', function() {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">    beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">7</td><td class="source">      databaseHelper.emptyModels([Flashband, FlashbandBatch]).finally(done);</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">    it('should associate flashband in', function(done) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">      var expectAssociation = function(err, flashbandBatch) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">        if (err) { return done(err); }</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">        FlashbandBatch.findOne(flashbandBatch.id).populate('flashbands').exec(function(err, saved) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">          if (err) { return done(err); }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">          expect(saved).to.be.ok;</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">          expect(flashbandBatch).to.have.property('flashbands');</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">          expect(saved.flashbands).to.have.length(1, 'wrong number of associated flashbands');</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">          expect(saved.flashbands[0]).to.have.property('tag', '123456');</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">          done();</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">      FlashbandService.enable([ {tag: '123456', serial: 1} ], 'lote 1').then(function() {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">        FlashbandBatch.findOne({name:'lote 1'}).exec(expectAssociation);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">      }).fail(done);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">    it('should ensure use waterline association FlashbandBatch -&gt; Flashband', function(done) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">      FlashbandService.enable([{ tag: '123456', serial: 1 }], 'lote 1', 'batch-file-content').then(function() {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">          FlashbandBatch.findOne({name:'lote 1'}).exec(function(err, flashbandBatch) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">            if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">            expect(flashbandBatch.flashbands).to.have.length(0);</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">            done();</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">    it('should save received batch file', function(done) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">      FlashbandService.enable([{ tag: '123456', serial: 1 }], 'lote 1', 'batch-file-content').then(function() {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">          FlashbandBatch.findOne({name:'lote 1'}).exec(function(err, flashbandBatch) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">            if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">            expect(flashbandBatch).to.have.property('file', 'batch-file-content');</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">            done();</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">    it('should activate created flashbandBatch', function(done) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">      FlashbandService.enable([{ tag: '123456', serial: 1 }], 'lote 1').then(function() {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">          FlashbandBatch.findOne({name:'lote 1'}).exec(function(err, flashbandBatch) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">            if (err) { return done(err); }</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">            expect(flashbandBatch.active).to.be.ok;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">1</td><td class="source">            done();</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">    it('should inactivate prior active flashband batch', function (done) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">      flashbandBatchHelper.createActive('lote 1').then(function(priorFlashbandBatch) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">        FlashbandService.enable([{ tag: '123456', serial: 1 }], 'lote 2').then(function() {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">          FlashbandBatch.findOne(priorFlashbandBatch.id).exec(function(err, flashbandBatch) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">            if (err) { return done(err); }</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">            expect(flashbandBatch.active).to.be.not.ok;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">            done();</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">    it('should destroy existing flashbands', function (done) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">      flashbandHelper.createSuccess('123456').then(function() {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">        FlashbandService.enable([{ tag: '234567', serial: 1 }], 'lote 1').then(function() {</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">          Flashband.findOne({ tag: '123456', imported: true}).exec(function(err, savedFlashband) {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">            if (err) { return done(err); }</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">            expect(savedFlashband).to.be.not.ok;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">            Flashband.find({imported: true}).exec(function(err, flashbands) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">              if (err) { return done(err); }</td></tr><tr class="hit"><td class="line">90</td><td class="hits">1</td><td class="source">              expect(flashbands).to.have.length(1);</td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">              expect(flashbands[0]).to.have.property('tag', '234567');</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">              done();</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">        }).fail(done);</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">    it('should reject duplicated flashbands', function(done) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">      var flashbands = [ { tag: '123456', serial: 1 }, { tag: '123456', serial: 1 } ];</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">      expect(FlashbandService.enable(flashbands, 'lote 1')).to.be.rejected.and.notify(done);</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/flashband/exists.test.js">/home/luiz/Projects/flashband/api/test/unit/services/flashband/exists.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">11</div><div class="hits">11</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var fbHelp = require('../../../helpers/FlashbandHelper');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">describe('FlashbandService', function() {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  describe('#exists', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">    it('should check if a flashband exists', function(done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">      var verifyFlashbandExists = function(flashSuccess) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">        expect(FlashbandService.exists(flashSuccess.tag)).to.eventually.have.property('tag', flashSuccess.tag).and.notify(done);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">      fbHelp.createSuccess().then(verifyFlashbandExists, done);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">    it('should check for a flashband that not exists', function(done) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">      expect(FlashbandService.exists('111111')).to.be.rejectedWith('Flashband not found').and.notify(done);</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/flashband/importer.test.js">/home/luiz/Projects/flashband/api/test/unit/services/flashband/importer.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">45</div><div class="hits">45</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var stringReadableStream = require('../../../helpers/StringReadableStream');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">describe('FlashbandBatchImporter', function () {</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">  describe('#parse', function() {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">    it('should import one valid flashband', function(done) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n000001;80 28 53 3A 0A 83 04 88';</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.eventually.deep.equal([{tag: '8028533A0A830488', serial: '000001'}]).and.notify(done);</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">    it('should ignore empty flashbands', function(done) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n;\n000001;80 28 53 3A 0A 83 04 88';</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.eventually.deep.equal([{tag: '8028533A0A830488', serial: '000001'}]).and.notify(done);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">    it('should reject files with duplicated UID', function(done) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n000001;80 28 53 3A 0A 83 04 88\n000002;80 28 53 3A 0A 83 04 88';</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('Duplicated UID.').and.notify(done);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">    it('should reject files with duplicated Qrcode', function(done) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n000001;80 28 53 3A 0A 83 04 88\n000001;00 00 00 00 00 00 00 00';</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('Duplicated Qrcode.').and.notify(done);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">    it('should reject empty file', function(done) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">      var fileContent = '';</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('No flashbands found.').and.notify(done);</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">    it('should reject invalid flashbands (without UID)', function(done) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n000001;80 28 53 3A 0A 83 04 88\n000002;';</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('Missing UID.').and.notify(done);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">    it('should reject invalid flashbands (without Qrcode)', function(done) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n000001;80 28 53 3A 0A 83 04 88\n;11 22 33 44 55 66 77 88';</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('Missing Qrcode.').and.notify(done);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">    it('should reject file without flashbands', function(done) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID ';</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('No flashbands found.').and.notify(done);</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">    it('should reject file with only empty flashbands', function(done) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">      var fileContent = 'Qrcode      ;UID \n;\n;\n';</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('No flashbands found.').and.notify(done);</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">    it('should reject an csv file with wrong format', function(done) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">      var fileContent = 'code;text\n1;foo\n2;bar';</td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">      var importFile = stringReadableStream.createReadableStream(fileContent);</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">      expect(FlashbandBatchImporter.parse(importFile)).to.be.rejectedWith('No flashbands found.').and.notify(done);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">//</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/check.test.js">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/check.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">10</div><div class="hits">10</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">require('chai').use(require('chai-as-promised')).should();</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var fdHelp = require('../../../helpers/FrontdoorHelper');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">describe('FrontdoorService', function() {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  describe('#checkRegistered', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">    it('should return false when ShowGoer not entry', function (done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">      FrontdoorService.checkRegistered('1234').should.eventually.equal(false).notify(done);</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">    it('should return true when ShowGoer ever entry', function (done) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">      fdHelp.createEntrance().then(function(entrance) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">        FrontdoorService.checkRegistered(entrance.tag).should.eventually.equal(true).notify(done);</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/enter.test.js">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/enter.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">21</div><div class="hits">21</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var Q = require('q');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var fbHelp = require('../../../helpers/FlashbandHelper');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var fdHelp = require('../../../helpers/FrontdoorHelper');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">describe('FrontdoorService', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">  describe('#registerEnter', function() {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">    it('should not register entrance when ShowGoer already in', function (done) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">      var verifyDuplicated = function(flashSuccess) {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">        FrontdoorService.registerEnter(flashSuccess.tag).should.be.rejectedWith('Duplicated entrance.').notify(done);</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">      fdHelp.createEntrance().then(verifyDuplicated, done);</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">    it('should not register entrance when ShowGoer blocked flashband', function (done) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">      var verifyFlashBandBlocked = function(flashBlocked ) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">        FrontdoorService.registerEnter(flashBlocked.tag).should.be.rejectedWith('Blocked flashband.').notify(done);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">      fbHelp.createBlocked().then(verifyFlashBandBlocked, done);</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">    it('should not register entrance when flashband not imported', function (done) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">      FrontdoorService.registerEnter('0000000001').should.be.rejectedWith('Flashband not found.').notify(done);</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">    it('should register entrance when ShowGoer not already in', function (done) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">      var verifyEntrance = function(flashSuccess) {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">        var promise = FrontdoorService.registerEnter(flashSuccess.tag);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">        Q.all([</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">          promise.should.eventually.have.property('id'),</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">          promise.should.eventually.have.property('tag', flashSuccess.tag)</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">        ]).should.notify(done);</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">      fbHelp.createSuccess().then(verifyEntrance);</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/leave.test.js">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/leave.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">20</div><div class="hits">20</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var Q = require('q');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var fdHelp = require('../../../helpers/FrontdoorHelper');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">describe('FrontdoorService', function() {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  describe('#registerLeave', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">    it('should not register leave when flashband not imported', function (done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">      FrontdoorService.registerLeave('0000000001').should.be.rejectedWith('Flashband not found.').notify(done);</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">    it('should not register leave when ShowGoer blocked flashband', function (done) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">      var verifyFlashBandBlocked = function(flashBlocked) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">        FrontdoorService.registerLeave(flashBlocked.tag).should.be.rejectedWith('Blocked flashband.').notify(done);</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">      fdHelp.createEntranceAndBlocked().then(verifyFlashBandBlocked, done);</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">    it('should register leave when ShowGoer go home', function (done) {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">      var verifyLeave = function(entrance) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">        var promise = FrontdoorService.registerLeave(entrance.tag);</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">        Q.all([</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">          promise.should.eventually.have.property('leave'),</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">          promise.should.eventually.have.property('tag', entrance.tag)</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">        ]).should.notify(done);</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">      fdHelp.createEntrance().then(verifyLeave, done);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">    it('should not register leave when ShowGoer already out', function (done) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">      var verifyDuplicated = function(entrance) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">        FrontdoorService.registerLeave(entrance.tag).should.be.rejectedWith('Duplicated exit.').notify(done);</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">      };</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">      fdHelp.createLeave().then(verifyDuplicated, done);</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/register.test.js">/home/luiz/Projects/flashband/api/test/unit/services/frontdoor/register.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var dbHelp = require('../../../helpers/DatabaseHelper');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var fbHelp = require('../../../helpers/FlashbandHelper');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">describe('FrontdoorService', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">  describe('#register', function() {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">    beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">2</td><td class="source">      dbHelp.emptyModels([Entrance]).finally(done);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">    it('should create an Entrance', function (done) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">      fbHelp.createSuccess().then(function verifyRegisterEntrance(flashband) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">        expect(FrontdoorService.registerEnter(flashband.tag)).to.eventually.have.property('tag', flashband.tag).and.notify(done);</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">      }, done);</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">    it('should not register entrance when non existing flashband', function (done) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">      expect(FrontdoorService.registerEnter('5678')).to.be.rejectedWith('Flashband not found.').and.notify(done);</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/home/luiz/Projects/flashband/api/test/unit/services/showgoer/create.test.js">/home/luiz/Projects/flashband/api/test/unit/services/showgoer/create.test.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">50</div><div class="hits">50</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var expect = require('chai').use(require('chai-as-promised')).expect;</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var dbHelp = require('../../../helpers/DatabaseHelper');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">describe('ShowgoerService', function() {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">  describe('#create', function() {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">    beforeEach(function(done) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">10</td><td class="source">      dbHelp.emptyModels([Showgoer]).then(done).fail(done);</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">    it('should save showgoer', function(done) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'cpf', docNumber: '111.111.111-11'};</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">      expect(ShowgoerService.create(showgoer)).to.eventually.have.property('id').and.notify(done);</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">    it('should require name', function(done) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">      var showgoer = {name: '', docType: 'cpf', docNumber: '111.111.111-11'};</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">      expect(ShowgoerService.create(showgoer)).to.eventually.be.rejectedWith('Name is required.').and.notify(done);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">    it('should require doctype', function(done) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: '', docNumber: '111.111.111-11'};</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">      expect(ShowgoerService.create(showgoer)).to.eventually.be.rejectedWith('Document type is required.').and.notify(done);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">    it('should require docNumber', function(done) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'cpf', docNumber: ''};</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">      expect(ShowgoerService.create(showgoer)).to.eventually.be.rejectedWith('Document number is required.').and.notify(done);</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">    it('should accept cpf', function(done) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'cpf', docNumber: 'cpf-number'};</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">      ShowgoerService.create(showgoer).then(function(modelSG) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docType', 'cpf');</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docNumber', 'cpf-number');</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">    it('should accept cnh', function(done) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'cnh', docNumber: 'cnh-number'};</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">      ShowgoerService.create(showgoer).then(function(modelSG) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docType', 'cnh');</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docNumber', 'cnh-number');</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">    it('should accept rg', function(done) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'rg', docNumber: 'rg-number'};</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">      ShowgoerService.create(showgoer).then(function(modelSG) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docType', 'rg');</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docNumber', 'rg-number');</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">    it('should accept passport', function(done) {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'passport', docNumber: 'passport-number'};</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">      ShowgoerService.create(showgoer).then(function(modelSG) {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docType', 'passport');</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">        expect(modelSG).to.have.property('docNumber', 'passport-number');</td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">    it('should reject invalid doctype', function(done) {</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'inv', docNumber: 'invalid-doctype'};</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">      expect(ShowgoerService.create(showgoer)).to.eventually.be.rejectedWith('Invalid document type.').and.notify(done);</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">    it('should reject duplicated document number and type', function(done) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">      var showgoer = {name: 'Fulano de Tal', docType: 'rg', docNumber: 'some-rg'};</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">      ShowgoerService.create(showgoer).then(function() {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">        expect(ShowgoerService.create(showgoer)).to.eventually.be.rejectedWith('Duplicated document.').and.notify(done);</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">      }).fail(done);</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div></div></div></body></html>
[32mDone, without errors.[39m
